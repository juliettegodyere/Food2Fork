<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="Formelo Mobility" name="description" />
    <meta content="PM Global Technology" name="author" />

    <link rel="stylesheet" href="css/fontawesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/jquery.mobile.min.css" />

    <!--<link rel="stylesheet" href="assets/plugins/animate.min.css" />-->
    <link href="assets/plugins/boostrapv3/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/bootstrap-tag/bootstrap-tagsinput.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/flexboxgrid.min.css" />
    <link class="main-stylesheet" href="pages/css/pages.min.me.css" rel="stylesheet" type="text/css" />
    <link class="main-stylesheet" href="pages/css/pages-icons.min.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="css/tooltipster.css" />
    <!--<link rel="stylesheet" href="css/tooltipster-shadow.css"/>-->
    <link rel="stylesheet" href="vendor/rating/jquery.raty.css"/>
    <link rel="stylesheet" href="vendor/swiper/swiper.min.css"/>
    <link rel="stylesheet" href="css/index.min.css"/>
    <link rel="stylesheet" href="assets/plugins/alerts/sweet-alert.css" />
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSUgYNb9iy2rdDZGJ2bFgP0eB57eX2_6Y" defer> </script>
</head>
<body id="body">
<!--<div data-role="page" id = "selector-page">
    <div id="aaa">
    <img class = "donkeyCache" donkey-id="http://www.solearestaurant.com/_Upload/imgs/websites/f7c81960-d43a-4789-8219-9f8f00d1fd9c/FB.png" />
    </div>
</div> --->

<div data-role="page" id = "selector-page">

    <!-- Slider main container -->
    <div class="swiper-container full-vh">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            <div class="swiper-slide" style="xheight:inherit; background: #00c6ff;background: -webkit-linear-gradient(to left, #00c6ff , #0072ff); background: linear-gradient(to left, #00c6ff , #0072ff);">
                <div style="height: inherit;"><img src="img/default/logo_darkbg.png" style="margin-top: 20%;
width: 20%"><p style="margin-top: 10%;
font-size: x-large;
color: white;">Update Schedule Monitor</p><p style="margin-top: 5%;
font-size: large;
color: white;">All your social networks in one app.</p><img src="img/dummy.png" width="50" style="margin-top: 8%;
width: 100%;margin-left: -6%;"><br></div>
            </div>
            <div class="swiper-slide">Slide 2</div>
            <div class="swiper-slide">Slide 3</div>
            ...
        </div>
        <!-- If we need pagination -->
        <div class="swiper-pagination"></div>

        <!-- If we need navigation buttons -->
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>

        <!-- If we need scrollbar -->
        <div class="swiper-scrollbar"></div>
    </div>


    <div style="height: 40px !important; max-height: 40px !important;" data-position ="fixed" data-tap-toggle="false" data-hide-during-focus="false" data-role="footer" data-position-fixed="true">
        <div style="height: inherit; margin-top: -4px" data-role="navbar">
            <ul>
                <li class="add_hover_effect" onclick="openPrivateChannel()">
                    <a class="nav_item_stats" style="margin-top: -4%; border:none !important;">
                        <span class="footer-icon"><i class="fa fa-heart"> </i></span> <p class="footer_p" style="margin-top: -4px; color:grey !important;" id="privateAppletPlaceHolder">Open a Workspace</p></a></li>
                <li class="add_hover_effect" onclick="openPublicChannel()">
                    <a class="nav_item_stats" style="margin-top: -4%; border:none !important; background-color: #00648c !important;">
                        <span class="footer-icon" style="color:white"><i class="pg-arrow_lright_line_alt"> </i></span> <p class="footer_p" style="margin-top: -4px; color:white !important;" id="privateAppletPlaceHolder">Discover Applets</p></a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id = "xselector-page">
    <!-- BEGIN JUMBOTRON -->
    <section class="jumbotron full-vh hidden-content aba">
        <div class="inner full-vh">
            <!-- BEGIN SLIDER -->
            <div class="swiper-codntainer full-vh" id="heroSlider">
                <div class="swiper-wrapper full-vh">
                    <!-- BEGIN SLIDE -->
                    <div class="swiper-slide fit full-vh">
                        <!-- BEGIN IMAGE PARRALAX -->
                        <div class="slider-wrapper">
                            <div class="background-wrapper" data-swiper-parallax="30%">
                                <!-- YOUR BACKGROUND IMAGE HERE, YOU CAN ALSO USE IMG with the same classes -->
                                <div id="splash-background-image" data-pages-bg-image="https://www.colourbox.com/preview/5440517-night-modern-city-vector-abstract-background.jpg" draggable="false" class="background"></div>
                            </div>
                        </div>
                        <div class="content-layer">
                            <div class="inner full-height">
                                <div class="container-xs-height full-height">
                                    <div class="col-xs-height col-middle text-center">
                                        <div class="container">
                                            <div class="col-md-12 no-padding col-xs-12 xcol-xs-offset-1">
                                                <h1 class="light sm-text-center" data-swiper-parallax="-15%">
                                                    <img id="splash-logo" src="" style="max-width: 256px"/>
                                                    <br/><br/>
                                                    <div class="blackBg">
                                                        <span class="xtranslucent-background" style="color: white !important;" id="welcomeGreetingHeader">Welcome back</span>
                                                    </div>
                                                </h1>
                                                <h4 class="sm-text-center blackBg">
                                                    <span class="translucent-background" style="color: white !important;">What would you like to do next?</span>
                                                </h4>
                                                <h5 class="block-title xtext-white sm-text-center" id="block-title"></h5>
                                                <p class="fs-12 font-arial hint-text sm-text-center"></p>
                                                <br/>
                                                <div class="row">
                                                    <div class="clickable-start-panel-padding" style="padding: 12px; margin-bottom: 6px;">&nbsp;
                                                    </div>
                                                    <!--<div id="privateAppletPlaceHolder" class="animated fadeInUp clickable-start-panel" style="padding: 12px; margin-bottom: 6px;" onclick="openPrivateChannel()">
                                                        <div class = "row" style="height: inherit;">
                                                            <div class="col-xs-12 col-sm-12 col-md-12" style = "padding: 0px;">
                                                                <img id="btn-workspace" src="" style="max-width: 100%; opacity: 0.95" />
                                                            </div>
                                                            <div class="col-xs-12 col-sm-12 col-md-12" style = " height:32px; max-height:32px; background-color:#404040;">
                                                                <span id="privateAppletText" style="font-size: x-small; color: #ffffff; font-weight:400">Open a Workspace</span>
                                                            </div>
                                                        </div>
                                                    </div>-->
                                                    <!--<div id="publicAppletPlaceHolder" class="animated fadeInUp clickable-start-panel" style="padding: 12px; margin-bottom: 6px;"  onclick="openPublicChannel()">
                                                        <div class = "row" style="height: inherit;">
                                                            <div class="col-xs-12 col-sm-12 col-md-12" style = "padding: 0px;">
                                                                <img id="btn-utility" src="" style="max-width: 100%; opacity: 0.95" />
                                                            </div>
                                                            <div class="col-xs-12 col-sm-12 col-md-12" style = " height:32px; max-height:32px; background-color:#00648c;">
                                                                <span id="publicAppletText" style="font-size: x-small; color: #ffffff; font-weight:400">Discover Applets</span>
                                                            </div>
                                                        </div>
                                                    </div> -->
                                                    <div class="clickable-start-panel-padding" style="padding: 12px; margin-bottom: 6px;">&nbsp;
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- END CONTENT -->
                    </div>
                    <!-- END SLIDE -->
                    <!-- Add Navigation -->
                </div>
                <!-- If we need pagination -->
                <div class="swiper-pagination"></div>
                <!-- If we need scrollbar -->
                <div class="swiper-scrollbar"></div>
            </div>
        </div>
        <!-- END SLIDER -->
    </section>
    <!-- END JUMBOTRON -->
    <div style="height: 40px !important; max-height: 40px !important;" data-position ="fixed" data-tap-toggle="false" data-hide-during-focus="false" data-role="footer" data-position-fixed="true">
        <div style="height: inherit; margin-top: -4px" data-role="navbar">
            <ul>
                <li class="add_hover_effect" onclick="openPrivateChannel()">
                    <a class="nav_item_stats" style="margin-top: -4%; border:none !important;">
                        <span class="footer-icon"><i class="fa fa-heart"> </i></span> <p class="footer_p" style="margin-top: -4px; color:grey !important;" id="privateAppletPlaceHolder">Open a Workspace</p></a></li>
                <li class="add_hover_effect" onclick="openPublicChannel()">
                    <a class="nav_item_stats" style="margin-top: -4%; border:none !important; background-color: #00648c !important;">
                        <span class="footer-icon" style="color:white"><i class="pg-arrow_lright_line_alt"> </i></span> <p class="footer_p" style="margin-top: -4px; color:white !important;" id="privateAppletPlaceHolder">Discover Applets</p></a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id = "realm-page" class="hidden-content aba">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" class="blue-gradient">
        <h1 class="wow fadeIn" style="text-align:center">My Workspaces</h1>
        <a class="ui-btn ui-btn-left header-link" onclick="gotoCompanySplashScreen(true)"><i class="pg-arrow_left_line_alt"></i> Back</a>
        <a class="ui-btn ui-btn-right header-link" onclick="Users.showLoggedInUsers()">Switch <i class="icon ion-person-stalker"></i></a>
    </div>
    <div role="main" class="ui-content">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <h5 style="color:grey">Add a Workspace <i class="fa fa-question-circle tooltip" title="This is a short code that describes your team"></i></h5>
                <div class="input-group transparent">
                    <span class="input-group-addon">#</span>
                    <input type="text" class="form-control" id="realm" placeholder="Type a hashtag e.g myteam"/>
                </div>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-6">
                <button style="float:left" data-inline="true" id="validateRealm" type="button" class="btn btn-block btn-primary">
                    Search
                </button>
                <a data-inline="true" id="createrealm" style="float: left; margin-top: 15px;font-size: smaller; font-weight: 500;" href="#" onclick="administrator.startRegistration()">or Create a new Workspace</a>
            </div>
        </div>
        <br/>
        <h5 style="color:grey">Connect to a recent Workspace</h5>
        <div class="row" id = "team_selection_placeholder">

        </div>
    </div>
</div>

<div data-role="page" id = "login-page" class="hidden-content aba">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" class="blue-gradient">
        <a class="ui-btn ui-btn-left header-link" data-rel="back"><i class="pg-arrow_left_line_alt"></i> Back</a>
        <h1 style="text-align: center;">Login   </h1>
    </div>
    <div role="main" class="full-vh" data-inset="false">

        <div class="container-xs-height full-height">
            <div class="row-xs-height">
                <div class="col-xs-height col-middle">
                    <div class="error-container xtext-center">
                        <h1 class="error-number" style="color: grey;  text-align: center; padding: 15% 0%;"><img id="login_image" class="sm-image-responsive-height" src="" style="width:50%;"></h1>
                        <div class="row" style="padding:5%">
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <div class="form-group form-group-default required">
                                    <label>Username</label>
                                    <input type="email" id="username" class="form-control" required="" />
                                </div>
                                <div class="form-group form-group-default required">
                                    <label>Password</label>
                                    <input type="password" id="password" class="form-control" required="" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <button data-inline="true" id="login" type="button" class="btn btn-block btn-primary">
                                    <span class="pull-right"></span>
                                    Login
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div data-role="page" id="edit-profile-page" class="hidden-content aba full-vh" style="background-color:white;" >
    <div data-role="header" data-position="fixed" data-tap-toggle="false" class="blue-gradient" style="background-color:white; !important">
        <h1 class="wow fadeIn" style="text-align:center">Edit Profile</h1>
        <a class="ui-btn ui-btn-left header-link" data-rel="back"><i class="pg-arrow_left_line_alt"></i></a>
    </div>
    <div role="main">
        <br/>
        <div class="row">
            <div class="col-xs-0 col-sm-3 col-md-3"></div>
            <div class="col-xs-12 col-sm-6 col-md-6">
                <div class="row">
                    <div class="col-xs-4 col-sm-4 col-md-4">
                        <img src="img/camera.png" class="col-xs-12 col-sm-12 col-md-12 image-responsive-width">
                    </div>
                    <div class="col-xs-8 col-sm-8 col-md-8">
                        <div class="form-group form-group-default">
                            <input type="text" class="form-control" id="profile_first_name" placeholder="Firstname">
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <div class="form-group form-group-default">
                        <!--<label>Email Address</label>-->
                        <input type="email" class="form-control" id="profile_email_address" placeholder="Email address">
                    </div>
                    <div class="form-group form-group-default">
                        <!--<label>Phone Number</label>-->
                        <input type="number" class="form-control" id="profile_phone_number" placeholder="Phone Number">
                    </div>
                </div>
                <br/><br/><br/>
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <button id ="editProfileButton" data-inline="true" type="button" class="btn btn-primary ui-btn-inline">Update</button>
                </div>
            </div>
            <div class="col-xs-0 col-sm-3 col-md-3"></div>
        </div>
    </div>
</div>

<div data-role="page" id="invite-page" style="background-color:white;" class="hidden-content aba">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" class="blue-gradient" style="background-color:white; !important">
        <h1 class="wow fadeIn" style="text-align:center" id="invitation-header">Invite</h1>
        <a class="ui-btn ui-btn-left header-link" data-rel="back"><i class="pg-arrow_left_line_alt"></i></a>
        <a id="invite-button" class="ui-btn ui-btn-right header-link"><i xclass="pg-arrow_left_line_alt"></i>Invite</a>
    </div>
    <div role="main">
        <br/>
        <div class="row">
            <div class="col-xs-0 col-sm-3 col-md-3"></div>
            <div class="col-xs-12 col-sm-6 col-md-6">
                <div class="row full-vh">
                    <div class="col-xs-12 col-sm-12 col-md-12">
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 ">
                        <div class="container-xs-height">
                            <div class="row-xs-height">
                                <div class="col-xs-height col-middle">
                                    <div class="error-container text-center">
                                        <h1 class="error-number" style="color: grey;">
                                            <img class="sm-image-responsive-height" style="width:70px" src="img/empty-states/invite.png">
                                        </h1>
                                        <p class="semi-bold" style="color: grey">Type one or more email addresses below or</p>
                                        <p class="semi-bold" style="text-align: center; padding: 0px  10px; text-shadow: none; color:#4183D7" id="launch-contacts">Import from Contacts</p>
                                        <div class="form-group form-group-default" style="border:none;" id="invite-placeholder">
                                        </div>
                                        <p class="fs-12 hint-text" style="text-align: center; padding: 0px  10px; text-shadow: none; color:#4183D7" id="invite-loading-item">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-0 col-sm-3 col-md-3"></div>
        </div>
    </div>
</div>

<div data-role="page" id = "preview" class="hidden-content aba">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" class="blue-gradient">
        <a class="ui-btn ui-btn-left header-link" id="preview-close"><i class="pg-arrow_left_line_alt"></i> Exit</a>
        <h1 style="text-align: center;" id="preview-title">Login</h1>
    </div>
    <div role="main" class="ui-content" id="preview-main">
    </div>
</div>

<div id="form_group_list" data-role="page" xdata-id="myPage"></div>
<div data-role="page" id = "main_page" class = "dashboard" xdata-id="myPage"></div>
<div data-role="page" id="detail_page" xdata-id="myPage"></div>
<div data-role="page" id = "data_lists" class = "dashboard" data-id="myPage"></div>

<!-- Important, dont delete -->
<div id="testStrip" style="display: none">
</div>

<!-- Modal -->
<div class="modal fade slide-up disable-scroll" id="modalSlideUp" tabindex="-1" role="dialog" aria-hidden="false">
      <div class="modal-dialog ">
        <div class="modal-content-wrapper">
          <div class="modal-content">
            <div class="modal-header clearfix text-left">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
              </button>
              <h5 class="modal-title"></h5>
            </div>
            <div class="modal-body">

            </div>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
 </div>
<!-- /.modal-dialog -->
<!-- MODAL STICK UP SMALL ALERT -->
<div class="modal fade slide-right" id="modalSlideLeft" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content-wrapper">
          <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
            </button>
            <div class="container-xs-height full-height">
              <div class="row-xs-height">
                <div class="modal-header clearfix text-left">
                  <h5 class="text-primary modal-title"></h5>
                </div>
                <div class="modal-body col-xs-height col-middle text-center id="modal-body">
                  <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">Continue</button>
                  <button type="button" class="btn btn-default btn-block" data-dismiss="modal">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
<!-- /.modal-dialog -->
<!-- END MODAL STICK UP SMALL ALERT -->


<!--<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="cordova_plugins.js"></script>-->


<script src="js/jquery.min.js" ></script>
<script src="js/jquery.mobile.min.js"></script>
<script src="assets/plugins/boostrapv3/js/bootstrap.min.js"></script>
<script async src="assets/plugins/bootstrap-tag/bootstrap-tagsinput.min.js" defer></script>
<script src="assets/plugins/alerts/sweet-alert.min.js"></script>
<!--<script src="assets/plugins/boostrapv3/js/bootstrap.min.js"></script>-->
<script async src="vendor/facebook/facebook.js" async></script>
<script src="vendor/swiper/swiper.min.js"></script>
<script src="js/app/config.js"></script>
<script src="js/app/analytics.js"></script>
<script src="js/app/globals.js" ></script>
<script src="js/app/translator.js"></script>
<script src="js/app/functions.js" ></script>
<script src="js/app/camera.js" ></script>
<script src="js/classes/DB.js"></script>
<script src="js/classes/API.js"></script>
<script src="js/classes/Validate.js"></script>
<script src="js/app/index.js"></script>
<script src="js/app/sync.js"></script>
<script src="js/app/api.js"></script>
<script src="js/app/migrations.js"></script>

<script src="js/app/administrator.js"></script>
<script src="js/app/browser.js"></script>

<script src="js/app/cache.js"></script>
<script src="js/app/formelo.js"></script>

<script src="js/fastclick.js"></script>
<script src="js/socket.io.min.js"></script>

<script src="js/moment/moment.min.js"></script>
<script async src="js/jquery.signaturepad.min.js" defer></script>
<script async src="js/json2.min.js" defer></script>

<script src="js/jquery.tooltipster.min.js"></script>
<script async src="vendor/rating/jquery.raty.js" defer></script>

<script async src="js/highcharts.js" defer></script>
<script async src="vendor/color-thief/color-thief.js" defer></script>

<!--<script async src="vendor/highcharts/data.js" defer></script>
<script async src="vendor/highcharts/exporting.js" defer></script>
<script async src="vendor/highcharts/funnel.js" defer></script>
<script async src="vendor/highcharts/highcharts-more.js" defer></script>
<script async src="vendor/highcharts/solid-gauge.js" defer></script>
 -->



<script>
    /**
     * @constructor Handles the callback when app is opened from the browser
     * @example formelo://applet/dac0d5a7
     */
    function handleOpenURL(url) {
        setTimeout(function() {
            var paths = url.split("//");
            var main = paths[1].split("/");
            if (main[0] == "applet"){
                detailsController(main[1], '','selector-page');
            }
        }, 0);
    }
    // S T A R T  H E R E  O O O  ! ! !
    initApp();

    $(document).ready(function(){
        document.addEventListener('chcp_updateIsReadyToInstall', qeventCallback, false);
        /*document.addEventListener('chcp_updateLoadFailed', weventCallback, false);
        document.addEventListener('chcp_nothingToUpdate', eeventCallback, false);
        document.addEventListener('chcp_beforeInstall', reventCallback, false);
        document.addEventListener('chcp_updateInstalled', teventCallback, false);
        document.addEventListener('chcp_updateInstallFailed', yeventCallback, false);
        document.addEventListener('chcp_nothingToInstall', ueventCallback, false);
        document.addEventListener('chcp_beforeAssetsInstalledOnExternalStorage', ieventCallback, false);
        document.addEventListener('chcp_assetsInstalledOnExternalStorage', oeventCallback, false);
        document.addEventListener('chcp_assetsInstallationError', peventCallback, false);*/
    });

    function qeventCallback(eventData) {
        alert('An update is available and will be loaded.');
        showMessage('An update is available and will be loaded.');
    }
    function weventCallback(eventData) {alert('chcp_updateLoadFailed');}
    function eeventCallback(eventData) {alert('chcp_nothingToUpdate');}
    function reventCallback(eventData) {alert('chcp_beforeInstall');}
    function teventCallback(eventData) {alert('chcp_updateInstalled');}
    function yeventCallback(eventData) {alert('chcp_updateInstallFailed');}
    function ueventCallback(eventData) {alert('chcp_nothingToInstall');}
    function ieventCallback(eventData) {alert('chcp_beforeAssetsInstalledOnExternalStorage');}
    function oeventCallback(eventData) {alert('chcp_assetsInstalledOnExternalStorage');}
    function peventCallback(eventData) {alert('chcp_assetsInstallationError'+JSON.stringify(eventData));}

    // 1. Another set on initialization occurs in Functions.js, So if you wanna change anything with data you can do that.
    // Like Database creation and other stuffs. Consider that also
    // 2. Initialiation also occurs in migration.js but that will be triggered on app install and when the global DATABASE_VERSION variable is changed
    // 3. Initialization for Local Storage Keys, in the Manager Class in api.js
</script>


<script type="text/javascript">
    $('#validateRealm').on('click', function() {
        var realm = $('#realm').val();
        if (!realm.trim().length){
            showMessage('Please type in your Workspace\'s hashtag');
            return false;
        }
        try {
            $.when(validateRealm(realm))
                    .done(function(data){
                        // Save the realm into the list of realms
                        privateCtlr.saveRealm(data);
                        window.localStorage.realm = realm;
                        window.localStorage.realm_full = JSON.stringify(data);
                        if (globals.files.enablePublicDefaultUser){
                            skipLoginPage(realm, DEMO_CREDENTIALS.username, DEMO_CREDENTIALS.password, DEMO_CREDENTIALS.userId);
                            return false;
                        } else {
                            showLoginpage(data.id);
                        }
                    })
                    .fail(function(error){
                        sweetAlert("Oops...", error, "error");
                        //showMessage(error);
                    })
        } catch(e){
            //alert(JSON.stringify(e));
            sweetAlert("Oops...", "We could not validate your realm", "error");
            //showMessage('Error validating realm');
        }
    });
    function checkPreAuth() {}
    function validateRealm(realm) {
        var txDeferred = $.Deferred();
        var url = "https://system.formelo.com/actions/realms/about?realm="+realm;
        if (isonline()) {
            customFunctions.displayNotificationDialog("", "Searching for your Workspace");
            $.ajax({
                url: url,
                cache: false,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                type: "GET",
                success: function(data) {
                    customFunctions.closeNotificationDialog();
                    txDeferred.resolve(data);
                },
                error: function(xhr) {
                    customFunctions.closeNotificationDialog();
                    handleErrorCodes(xhr, txDeferred);
                },
                timeout: TIMEOUT
            });
        } else {
            txDeferred.reject("Please connect to the Internet and try again");
        }

        return txDeferred.promise();
    }
    $('#login').click(function(e) {
        e.stopPropagation();
        var username = $('#username').val();
        var password = $('#password').val();
        var data = {
            "username": username,
            "password": password
        };

        customFunctions.displayNotificationDialog("Please Wait", "Authenticating");
        $.when(login(data))
                .done(function (data) {
                    window.plugins.toast.show("You are now logged in!", 'short', 'bottom');
                    //TODO validate returned config
                    Users.saveUser(data);
                    window.localStorage["credentials"] = JSON.stringify(data);
                    $('#password').val('');
                    customFunctions.closeNotificationDialog();
                    $.when(setOneTimePassword())
                            .done(function() {
                                window.plugins.toast.show("All set. . . have fun!", 'short', 'bottom');
                                handleLogin(null, true);
                            });
                })
                .fail(function (error) {
                    customFunctions.closeNotificationDialog();
                    sweetAlert("Oops...", error, "error");
                    //window.plugins.toast.show(error, 'short', 'bottom');
                })
    });

    function login(credentials) {
        var txDeferred = $.Deferred();
        var url = getLoginEndpoint(credentials.username, credentials.password);
        if (isonline()) {
            $.ajax({
                url: url,
                cache: false,
                type: "POST",
                data: {
                    username : credentials.username,
                    password : credentials.password
                },
                success: function(data) {
                    if (errorExistsInConfig(data)) {
                        txDeferred.reject("Error exists in the configuration sent from the server");
                    } else {
                        txDeferred.resolve(data);
                    }
                },
                error: function(xhr) {
                    handleErrorCodes(xhr, txDeferred);
                },
                timeout: TIMEOUT
            });
        } else {
            txDeferred.reject("Please connect to the Internet and try again");
        }
        return txDeferred.promise();
    }
</script>


</body>
</html>
