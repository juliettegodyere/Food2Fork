{
    "icon_url": "https://cdn.formelo.com/20160823/11/1471951864155-logo_512x512.jpg",
    "user_group": {
        "name": "Sales Lead Management",
        "id": "d9c0c5a9"
    },
    "last_change": {
        "date": "2016-09-05T20:30:11",
        "user": {
            "code": "rd@pmglobaltechnology.com",
            "id": "d9e3a9a9"
        }
    },
    "description": "My Mobile CRM",
    "default_submission_status": "accepted",
    "mode": "dynamic",
    "pages": [
        {
            "layout": "<div class=\"row\" style=\"padding: 1% 3%;\">\n\t<div class=\"input-group transparent\">\n                    <span id=\"deals-filter\" class=\"input-group-addon\"><i class=\"fa fa-filter\"></i></span>\n                    <input type=\"text\" class=\"form-control\" id=\"deals-search\" placeholder=\"Search for Deals\" style=\"font-size:small !important;\"/>\n                </div>\n</div>\n\n<div id=\"deallist\">\n</div>",
            "css": "",
            "name": "Deals",
            "resources": "",
            "events": {
                "ready": "function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\nformelo.exports('numberWithCommas', numberWithCommas);\nvar notif = {\n  show: function(msg){\n  \tcustomFunctions.displayNotificationDialog(msg);\n  }, \n  hide : function (){\n  \tcustomFunctions.closeNotificationDialog();\n  }\n};\nformelo.exports('notif', notif);\n\nvar sendFile = function(str, personID, dealID, activityID, callBack){ \n  var endPoint = 'https://api.pipedrive.com/v1/files?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n  var form_data = new FormData();\n  var blob = formelo.helpers.base64ToFile(str);\n  form_data.append('file', blob);\n  form_data.append('deal_id', dealID);\n  form_data.append('person_id', personID);\n  form_data.append('activity_id', activityID);\n  \n  showMessage('Posting...', 'long');\n  notif.show();\n  $.when(sendFileData(endPoint, form_data, 'POST'))\n   .done(function(){\n    \tnotif.hide();\n    \tcallBack();\n   })\n   .fail(function(e){\n    \tnotif.hide();\n    \tshowMessage('Error adding error note. Please try again later');\n  \t\talert(JSON.stringify(e));\n   });\n};\nformelo.exports('sendFile', sendFile);\n\nvar sendFileData = function(url, _data, _method, _headers){\n    var data    = _data      || {};\n    var method  = _method    || 'GET';\n    var txDeferred = $.Deferred();\n    var headers = _headers || {};\n    if (isonline()){\n        $.ajax({\n            url : url,\n            type : method,\n            data : data,\n            cache: false,\n            processData: false,\n            contentType: false,\n            success : function(data){\n                txDeferred.resolve(data);\n            },\n            error: function(xhr){\n                txDeferred.reject(xhr);\n            },\n            timeout: TIMEOUT\n        });\n    } else{\n        txDeferred.reject('No internet connection');\n    }\n    return txDeferred.promise();\n};\nformelo.exports('sendFileData', sendFileData);\n\nvar activityMap = {\n\t'call' : {\n    \ttext : 'Call',\n        icon : 'https://iconic.sunrise.am/icon/google:events/fa565a.png?overlay=call&size=100'\n    },\n    'email' : {\n    \ttext : 'Email',\n        icon : 'http://uopa.esngreece.gr/sites/uopa.esngreece.gr/files/imce/mail_logo.png'\n    }, \n  \t'task' :  {\n    \ttext : 'Task',\n        icon : 'http://a5.mzstatic.com/au/r30/Purple/v4/d4/07/b9/d407b90c-acac-c27c-9408-a8ac1ae18d8b/icon100x100.png'\n    }, \n    'deadline' :  {\n    \ttext : 'Deadline',\n        icon : 'http://cosential.com/wordpress/wp-content/uploads/2016/05/secure-icon.png'\n    }, \n    'lunch' :  {\n    \ttext : 'Lunch',\n        icon : 'http://img4.cliparto.com/pic/s/204746/5086638-fast-food-sign-icon.jpg'\n    },\n    'meeting' :  {\n    \ttext : 'Meeting',\n        icon : 'http://icons.iconarchive.com/icons/graphicloads/100-flat-2/128/people-icon.png'\n    }\n};\nformelo.exports('activityMap', activityMap);\n\nvar fileMap = {\n\t'img' : {\n    \t'icon' : 'http://static1.squarespace.com/static/524caf98e4b0b5e2e07fd6cc/t/5638f435e4b02e7fe2d3dfbd/1446573109349'\n    }\n};\n\nformelo.exports('fileMap', fileMap);\n\n\nvar modalController = function(){\n    var rand = str_random(10);\n\treturn {\n    \tshow : function(body, title){\n          \t var html = '<div class=\"xx-bla-bla modal fade slide-right in\" id=\"'+rand+'\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"false\" style=\"display: block; overflow:scroll;>'+\n          '<div class=\"modal-dialog modal-sm\">'+\n          '<div class=\"modal-content-wrapper\">'+\n          '<div class=\"modal-content\">'+\n          '<br/>'+\n          '<div class=\"container-xs-height full-height\">'+\n          '<div class=\"row-xs-height\">'+\n          '<div class=\"modal-body col-xs-height col-middle xtext-center\" style=\"padding: 6px;\">'+\n          '<h5 class=\"text-primary\" style=\"text-align: center\"><span class=\"semi-bold\">'+title+'</span><span data-dismiss=\"modal\" style=\"float:right;'+\n          'margin-right: 10px;\"><i class=\"pg-close_line\"></i></span></h5>'+\n          '<div class=\"card share full-height no-margin-card\" data-social=\"item\">'+\n          body+\n          '</div>'+\n          '</div>'+\n          '</div>'+\n          '</div>'+\n          '</div>'+\n          '</div>'+\n          '<!-- /.modal-content -->'+\n          '</div>'+\n          '<!-- /.modal-dialog -->'+\n          '</div>';\n          $('body').append(html);\n          $('#'+rand).modal({\n                //backdrop: 'static',\n                //keyboard: false\n          });\n        },\n      \thide : function(){\n          \t$('#'+rand).modal('hide');\n            $('.xx-bla-bla').modal('hide');\n        }\n    };\t\n};\n\nformelo.exports('modalController', modalController);\n\nvar type = 'main';\nvar filter_id = null;\nvar loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nformelo.exports('loadingHtml', loadingHtml);\nvar blankHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            'No deals' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nformelo.exports('errorHtml', errorHtml);\nvar footer = [\n   {\n                'icon' : 'fa fa-dollar',\n                'text' : 'Deals',\n                'link' : null,\n                'active' :  true,\n                'unique' : 'deals'\n            },\n  {\n                'icon' : 'fa fa-calendar-o',            \n                'text' : 'Activities',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'activity'\n            },\n  {\n                'icon' : 'fa fa-user',\n                'text' : 'Contacts',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'contacts'\n            },\n  {\n                'icon' : 'fa fa-building',\n                'text' : 'Organizations',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'organization'\n            }\n];\n\n\n\nvar getDeals = function(){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/deals?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \t$('#deallist').html(loadingHtml);\n    var data = {\n    \tfilter_id : filter_id\n    };\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n      \tif (result){\n          result.forEach(function(item){\n        \tresArr.push({\n            \t'name' : item.title,\n                'description' : item.formatted_value + ' - '+ item.org_name + ' - ' + item.person_name,\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.title.trim().charAt(0).toUpperCase()+'.gif' \n                //'time' : item.status\n            });\n          });\n          formelo.ui().listAdapter(resArr, '#deallist').attach(function(item){\n              formelo.navigation().openActivity(6, {id : item});\n          });\n        } else {\n        \t$('#deallist').html(blankHtml);\n        }\n    })\n    .fail(function(e){\n    \t//showMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#deallist').html(errorHtml);\n    });\n  \tfilter_id = null;\n};\nvar searchDeals = function(searchTerm){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/deals/find?term=\"+searchTerm+\"&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    var data = {\n    \tterm : searchTerm\n    };\n  \t$('#deallist').html(loadingHtml);\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.title,\n                  'description' : item.formatted_value + ' - '+ item.organization_name + ' - ' + item.person_name,\n                  'unique' : item.id,\n                  'image' : 'img/bg/'+item.title.trim().charAt(0).toUpperCase()+'.gif'\n              });\n            });\n            formelo.ui().listAdapter(resArr, '#deallist').attach(function(item){\n                formelo.navigation().openActivity(6, {id : item});\n            });\n        } else {\n        \t$('#deallist').html('');\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#deallist').html(errorHtml);\n    });\n};\nvar handleItem = function(item){\n  formelo.navigation().openActivity(1);\n};\nvar handleMenu = function(item){\n  if (item === 'contacts') {\n  \t formelo.navigation().openActivity(7);\n  } else  if (item === 'activity'){\n  \t formelo.navigation().openActivity(9);\n  } else  if (item === 'deals'){\n  \t formelo.navigation().openActivity(0);\n  } else if (item === 'organization') {\n  \t formelo.navigation().openActivity(20);\n  }\n};\n\n\nformelo.event().onIntent(function(data){\n\tfilter_id = data.detail.filter_id;\n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetDeals();\n    }\n});\n\nformelo.event().onCreate(function(){\n    formelo.html().get.header.menu().html('Add').show().click(function(){\n    \tformelo.navigation().openActivity(5, {isNew:true});\n    });\n\tformelo.ui().footer(footer, function(item){\n    \thandleMenu(item);\n    });\n    getDeals();\n  \t$('#deals-filter').unbind().click(function(){\n    \tformelo.navigation().openActivity(14);\n    });\n    $('#deals-search').unbind().on('change', function(){\n      var val = $(this).val();\n      if (val && val.length >= 3){\n       \t searchDeals(val);\n      }\n    });\n});\n\nformelo.event().onClose(function(data){\n  formelo.navigation().stopPropagation();\n  navigator.notification.confirm(\n    \t'', \n      \tfunction(buttonIndex){\n        \tif (buttonIndex == 1){\n            \tformelo.close();               \n            }\n        },\n      \t'Quit?', \n      \t['Exit Applet', 'Cancel'],\n      \t'?'\n    );\n});"
            }
        },
        {
            "layout": "<div>\n\t<div class=\"card share full-height no-margin-card\" data-social=\"item\">\n\t<div class=\"card-header clearfix Sv8OzZm2qNpieKvIYvZq\" unique=\"asshole\">\n\t\t<div class=\"user-pic pull-left\"><img alt=\"Profile Image\" width=\"33\" height=\"33\" data-src-retina=\"http://cdn2.newsok.biz/cache/sq100-f6474d9abf7819d43b89e8ce1660658a.jpg\" data-src=\"http://cdn2.newsok.biz/cache/sq100-f6474d9abf7819d43b89e8ce1660658a.jpg\" src=\"http://cdn2.newsok.biz/cache/sq100-f6474d9abf7819d43b89e8ce1660658a.jpg\"></div>\n\t\t<h6 style=\"float: right; font-size: xx-small; display: inline;\">4 deals</h6>\n\t\t<div style=\"margin-left: 40px\">\n\t\t\t<h5 style=\"font-weight: 300;\">Tonale Drump</h5>\n\t\t\t<h6>Kiss America goodbye LTD</h6>\n\t\t</div>\n\t</div>\n</div>\n</div>\n\n<div>\n\t<ul class=\"nav nav-tabs nav-tabs-simple nav-tabs-up bg-white\" id=\"tab-3\">\n\t\t<li class=\"\">\n\t\t\t<a data-toggle=\"tab\" href=\"#tab3hellowWorld\" aria-expanded=\"false\">General</a>\n\t\t</li>\n\t\t<li class=\"active\">\n\t\t\t<a data-toggle=\"tab\" href=\"#tab3FollowUs\" aria-expanded=\"true\">Flow</a>\n\t\t</li>\n\t\t<li class=\"\">\n\t\t\t<a data-toggle=\"tab\" href=\"#tab3Inspire\" aria-expanded=\"false\">Deals</a>\n\t\t</li>\n\t</ul>\n\t<div class=\"tab-content bg-white\" style=\"\n\t\theight: 70vh;\">\n\t\t<div class=\"tab-pane\" id=\"tab3hellowWorld\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">No Deals</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"tab-pane active\" id=\"tab3FollowUs\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">No Flows</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"tab-pane\" id=\"tab3Inspire\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">No Deals</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
            "css": "",
            "name": "Oduonye",
            "resources": "",
            "events": {
                "ready": "var footer = [\n   {\n                'icon' : 'fa  fa-plus',\n                'text' : 'Add',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'add'\n            }\n];\n\nvar dummy = [\n   \t\t\t{\n                'name' : 'Call',\n                'description' : '9th August 2015 at 10:30am',\n                'unique' : 'asshole',\n                'image' :  'https://iconic.sunrise.am/icon/google:events/fa565a.png?overlay=call&size=100',\n                'time' : 'pending'\n            },\n\t\t\t{\n                'name' : 'Meeting',\n                'description' : '13th June 2016 at 1:30am',\n                'unique' : 'asshole',\n                'image' :  'http://www.meeting-mojo.com/wp-content/uploads/2013/01/meeting-icon-100x100.png',\n                'time' : 'pending'\n            },\n{\n                'name' : 'Task',\n                'description' : '31th Febuary 1902 at 12:30am',\n                'unique' : 'asshole',\n                'image' :  'http://a5.mzstatic.com/au/r30/Purple/v4/d4/07/b9/d407b90c-acac-c27c-9408-a8ac1ae18d8b/icon100x100.png',\n                'time' : 'pending'\n            },\n{\n                'name' : 'Email',\n                'description' : '12th August 2019 at 2:15pm',\n                'unique' : 'asshole',\n                'image' :  'http://uopa.esngreece.gr/sites/uopa.esngreece.gr/files/imce/mail_logo.png',\n                'time' : 'pending'\n            }];\n\nvar add = function(){\n\tnavigator.notification.confirm(\n    \t'Add new', \n      \tfunction(buttonIndex){\n        \tshowMessage('Added');\n          \tif (buttonIndex == 3){\n            \tformelo.navigation().openActivity(2);\n            } else if (buttonIndex == 1){\n            \tformelo.navigation().openActivity(3);\n            } else if (buttonIndex == 2) {\n            \tformelo.navigation().openActivity(5);\n            }\n        },\n      \t'', \n      \t['Activity', 'Deal', 'Note', 'Photo', 'Audio Note', 'Cancel'],\n      \t'Add new'\n    );\n};\n\nformelo.event().onCreate(function(){\n  formelo.ui().footer(footer, function(item){\n          add(item);\n  });\n  // get flow\n  getFlow();\n  getDeals();\n  \n});\n\nvar getFlow = function(){\n  var placeholder = \"#tab3FollowUs\";\n  formelo.ui().listAdapter(dummy, placeholder).attach(function(){\n  \t// open activity\n    formelo.navigation().openActivity(3);\n  });\n};\n\nvar getDeals = function(){\n};\n\n"
            }
        },
        {
            "layout": "<div style=\"height: 90vh;\">\n\t<textarea placeholeer=\"Tap here to start typing\" autofocus id=\"notes-input\" class=\"ui-input-text ui-shadow-inset ui-body-inherit ui-corner-all ui-textinput-autogrow\" style=\"height: inherit;\n\t\tcolor: black;\n\t\tborder: none;\"></textarea>\n</div>",
            "css": "",
            "name": "Add Notes",
            "resources": "",
            "events": {
                "ready": "var person_id = null;\nvar org_id = null;\nvar deal_id = null;\nvar notif = formelo.require('notif');\nfunction addNotes(person, org, deal){\n     var endPoint = \"https://api.pipedrive.com/v1/notes?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  var note = $('#notes-input').val();\n  var org_id = org;\n  var person_id = person;\n    var data = {\n      org_id : org_id,\n      person_id : person_id,\n      content : note,\n      deal_id : deal\n    };\n  \n  alert(JSON.stringify(data));\n  notif.show();\n   showMessage(\"Sending...\");\n   $.when(sendData(endPoint, data, \"POST\"))\n   .done(function(data){\n     \tnotif.hide();\n        alert(JSON.stringify(data));\n   \t\tshowMessage(\"Note has ben added.\");\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \talert(JSON.stringify(e));\n       \tshowMessage('Could not reach the server');\n   });\n}\n\nfunction sendData(url, _data, _method, _headers){\n    var data    = _data      || {};\n    var method  = _method    || 'GET';\n    var txDeferred = $.Deferred();\n    var headers = _headers || {};\n    if (isonline()){\n        $.ajax({\n            url : url,\n            type : method,\n            data : data,\n            cache: false,\n            processData: false,\n            success : function(data){\n                txDeferred.resolve(data);\n            },\n            error: function(xhr){\n                txDeferred.reject(xhr);\n            },\n            timeout: TIMEOUT\n        });\n    } else{\n        txDeferred.reject('No internet connection');\n    }\n    return txDeferred.promise();\n}\n\nfunction reset(){\n\t$('#notes-input').val('');\n}\nformelo.event().onIntent(function(data){\n\tperson_id = data.detail.person_id;\n\torg_id = data.detail.org_id;\n    deal_id = data.detail.deal_id;\n    alert(JSON.stringify(data.detail));\n});\n\nformelo.event().onCreate(function(){\n\t\treset();\t\t\t\t\n  \t   \tformelo.html().get.header.menu().html('Done').show().click(function(){\n    \taddNotes(person_id, org_id, deal_id );\n    });\n});"
            }
        },
        {
            "layout": "<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Choose Activity Type</label>\n\t<select id=\"activity-type\" class=\"form-control\">\n    \t<option value=\"call\">Call</option>\n        <option value=\"meeting\">Meeting</option>\n        <option value=\"task\">Task</option>\n        <option value=\"deadline\">Deadline</option>\n        <option value=\"email\">Email</option>\n        <option value=\"lunch\">Lunch</option>\n    </select>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Subject</label>\n\t<input placeholder=\"Tap to start typing\" id=\"activity-subject\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Date</label>\n\t<input placeholder=\"Tap to start typing\" id=\"activity-duedate\" type=\"date\" class=\"form-control\"/>\n</div>\n<!--<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Assigned to</label>\n\t<input id=\"activity-owner\" type=\"text\" value=\"Daniel Oduonye (You)\" class=\"form-control\"/>\n</div>-->\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Add note</label>\n\t<textarea placeholder=\"Tap to start typing\" id=\"activity-note\" class=\"form-control\" style=\"height: 100px;\">\n    </textarea>\n</div>\n<div style=\"padding:3%;\" class=\"activity-contact\">\n<h6 style=\"text-align:center\">LINKED CONTACT</h6>\n<hr>\n  <div class=\"form-group form-group-default\">\n      <label for=\"aa\" class=\"formelo-form-label\">Choose Contact</label>\n      <input placeholder=\"Tap to choose\" readonly id=\"activity-linked-person\" type=\"text\" value=\"\" class=\"form-control\"/>\n  </div>\n  <div class=\"form-group form-group-default\">\n      <label for=\"aa\" class=\"formelo-form-label\">Choose Organization</label>\n      <input placeholder=\"Tap to choose\" readonly id=\"activity-linked-organization\" type=\"text\" value=\"\" class=\"form-control\"/>\n  </div>\n  <div class=\"form-group form-group-default showDeal\">\n      <label for=\"aa\" class=\"formelo-form-label\">Choose Deal</label>\n      <input placeholder=\"Tap to choose\" readonly id=\"activity-linked-deal\" type=\"text\" value=\"\" class=\"form-control\"/>\n  </div>\n</div>\n\n\n",
            "css": "",
            "name": "New Activity",
            "resources": "",
            "events": {
                "ready": "var person_id = null;\nvar org_id = null;\nvar deal_id = null;\nvar isNew = true;\nvar showDeal = \"yes\";\nvar showLinkedContacts = \"no\";\n\nvar modalController = formelo.require('modalController');\nvar notif = formelo.require('notif');\nvar loadingHtml = formelo.require('loadingHtml');\nvar activityID = null;\n\n\n\nfunction showOptions(buttonIndex){\n     //alert(buttonIndex);\n  \tif (buttonIndex === 'delete') {\n    \t   var endPoint = \"https://api.pipedrive.com/v1/activities/\"+activityID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n            notif.show();\n           $.when(sendData(endPoint, {}, \"DELETE\"))\n           .done(function(data){\n                notif.hide();\n                showMessage('Deleted.');\n                formelo.navigation().result({type : 'reload'});\n           })\n           .fail(function(e){\n                notif.hide();\n                alert(JSON.stringify(e));\n                showMessage('Could not contact the server.');\n           });\n    } else {\n      \tvar st = buttonIndex.split('|');\n      \tif (st[0] === 'call'){\n           navigator.notification.confirm(\n              '', \n              function(buttonIndex){\n                  if (buttonIndex == 1){\n                      window.open('tel:'+st[1], '_system');             \n                  }\n              },\n              st[1], \n              ['Call', 'Cancel'],\n              ''\n          );\n        } else {\n        \tvar active = st[1] === \"true\" ? 0 : 1; \n    \t\tsendUpdate({done:active});\n        }\n    }\n}\n\nfunction showFooter(completed, item){\n  \tvar txt = completed ? \"true\" : \"false\";\n\tvar footer = [\n   \t\t\t{\n                'icon' : 'fa fa-close',\n                'text' : 'Delete',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'delete'\n            },\n  \t\t\t{\n                'icon' : 'fa fa-check',\n                'text' : completed === true ? 'Mark as Active' : 'Mark as Completed',\n                'link' : null,\n                'active' :  completed === true ? true : false,\n                'unique' : 'complete|'+txt\n            }\n];\n  var phoneExist = false;\n  if (item.data.type === 'call' \n      && item.related_objects\n      && item.related_objects.person\n     ){\n  \t\tvar persons = item.related_objects.person;\n    \tfor (var key in persons){\n        \tif(persons[key] && persons[key].phone && persons[key].phone.length){\n              \tvar phone  = persons[key].phone[0].value;\n            \tphoneExist = phone === '' ? false : phone;\n            }\n        }\n  }\n  \n  if (phoneExist !== false){\n  \t\tfooter.push({\n                'icon' : 'fa fa-phone',\n                'text' : 'Call',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'call|'+phoneExist\n            });\n  }\n  \n  formelo.ui().footer(footer, function(item){\n           showOptions(item);\n  });\n}\n\nfunction getDetailsForActivity(id){\n\t     var endPoint = 'https://api.pipedrive.com/v1/activities/'+id+'?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n        $.when(fetchData(endPoint))\n        .done(function(data){\n             var result = data.data;\n          \t\tshowFooter(result.active_flag, data);\n        \t  \t$('#activity-type').val(result.type);\n              \t$('#activity-subject').val(result.subject);\n              \t$('#activity-duedate').val(result.due_date);\n              \t$('#activity-note').val(result.note);\n              \t$('#activity-owner').val(result.owner_name);\n            var html = '';\n             if (data.related_objects && data.related_objects.person){\n                for (var key in data.related_objects.person) {\n                   if (key + \" = \" +data.related_objects.person[key]){\n                     \t$('#activity-linked-person').val(data.related_objects.person[key].name).attr('data-id', data.related_objects.person[key].id);\n                  break;\n                   }\n                }\n             }\n          if (data.related_objects && data.related_objects.organization){\n                for (var key in data.related_objects.organization) {\n                   if (data.related_objects.organization[key]){\n                     $('#activity-linked-organization').val(data.related_objects.organization[key].name).attr('data-id', data.related_objects.organization[key].id);\n                   }\n                }\n             }\n          if (data.related_objects && data.related_objects.deal){\n                for (var key in data.related_objects.deal) {\n                   if (data.related_objects.deal[key].name){\n                     $('#activity-linked-deal').val(data.related_objects.deal[key].name).attr('data-id', data.related_objects.deal[key].id);\n                  break;\n                   }\n                }\n             }\n          \n        })\n        .fail(function(err){\n            alert(JSON.stringify(err));\n          \tshowMessage('Error occured while displaying data.');\n        });\n}\n\nfunction link(){\n  \t$('#activity-type').val('call');\n\t$('#activity-linked-person').click(function(){\n      \tformelo.navigation().openActivity(17);\n    });\n    $('#activity-linked-organization').click(function(){\n      formelo.navigation().openActivity(18);\n    });\n    $('#activity-linked-deal').click(function(){\n      formelo.navigation().openActivity(19);\n    });\n}\n\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'persons'){\n    \t$('#activity-linked-person').val(data.detail.name).attr('data-id', data.detail.id);\n    } else if (data.detail.type === 'organizations'){\n    \t$('#activity-linked-organization').val(data.detail.name).attr('data-id', data.detail.id);\n    } else if (data.detail.type === 'deals'){\n    \t$('#activity-linked-deal').val(data.detail.name).attr('data-id', data.detail.id);\n    }\n});\n\n\n\nfunction addActivity(){\n  var endPoint = \"https://api.pipedrive.com/v1/activities?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  var subject = $('#activity-subject').val();\n  var type = $('#activity-type').val();\n  var note = $('#activity-note').val();\n  var person_id = $('#activity-linked-person').attr('data-id');\n  var org_id = $('#activity-linked-organization').attr('data-id');\n  var deal_id = $('#activity-linked-deal').attr('data-id');\n  var due_date = $('#activity-duedate').val();\n  var due_time = \"12:00\";\n    var datas = {\n      subject : subject,\n      type : type,\n      org_id : org_id ? parseInt(org_id) : null,\n      person_id : person_id ? parseInt(person_id) : null,\n      note : note,\n      deal_id : deal_id ? parseInt(deal_id) : null,\n      due_time : due_time,\n      due_date : due_date,\n      done: 0\n    };\n   \n   notif.show();\n   $.when(sendData(endPoint, datas, \"POST\"))\n   .done(function(data){\n     \tnotif.hide();\n     \talert(JSON.stringify(data));\n        showMessage('Your Activity has been created.');\n     \tformelo.navigation().result({type : 'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \talert(JSON.stringify(e));\n        showMessage('Could not contact the server');\n   });\n}\n\nfunction updateActivity(){\n  var subject = $('#activity-subject').val();\n  var type = $('#activity-type').val();\n  var note = $('#activity-note').val();\n  var person_id = $('#activity-linked-person').attr('data-id');\n  var org_id = $('#activity-linked-organization').attr('data-id');\n  var deal_id = $('#activity-linked-deal').attr('data-id');\n  var due_date = $('#activity-duedate').val();\n  var due_time = \"12:00\";\n    var data = {\n      subject : subject,\n      type : type,\n      org_id : org_id,\n      person_id : person_id,\n      note : note,\n      deal_id : deal_id,\n      user_id : 1659810,  \n      due_time : due_time,\n      due_date : due_date \n    };\n   sendUpdate(data);\n}\n\nfunction sendUpdate(data){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/activities/\"+activityID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n\tnotif.show();\n   $.when(sendData(endPoint, data, \"PUT\"))\n   .done(function(data){\n     \tnotif.hide();\n        alert(JSON.stringify(data));\n     \tshowMessage('Updated.');\n        formelo.navigation().result({type : 'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \talert(JSON.stringify(e));\n        showMessage('Could not contact the server.');\n   });\n}\n\nfunction sendData(url, _data, _method, _headers){\n    var data    = _data      || {};\n    var method  = _method    || 'GET';\n    var txDeferred = $.Deferred();\n    var headers = _headers || {};\n    if (isonline()){\n        $.ajax({\n            url : url,\n            type : method,\n            data : data,\n            cache: false,\n            //processData: false,\n            success : function(result){\n                txDeferred.resolve(result);\n            },\n            error: function(xhr){\n                txDeferred.reject(xhr);\n            },\n            timeout: TIMEOUT\n        });\n    } else{\n        txDeferred.reject('No internet connection');\n    }\n    return txDeferred.promise();\n}\n\nfunction reset(){\n\t$('#activity-subject').val('');\n    $('#activity-type').val('');\n    $('#activity-note').val('');\n    $('#activity-duedate').val('');\n    $('#activity-linked-person').val('').attr('data-id', '');\n    $('#activity-linked-organization').val('').attr('data-id', '');\n    $('#activity-linked-deal').val('').attr('data-id', '');\n}\n\n\nformelo.event().onIntent(function(data){\n\tperson_id = data.detail.person_id;\n\torg_id = data.detail.org_id;\n    deal_id = data.detail.deal_id;\n  \tshowDeal = data.detail.showDeal;\n    isNew = data.detail.isNew === false ? data.detail.isNew : true;\n    activityID = data.detail.activityID;\n  \tshowLinkedContacts = data.detail.showLinkedContacts;\n});\n\nformelo.event().onCreate(function(){\n  \treset();\n  \tif (showDeal !== 'yes'){\n    \t$('.showDeal').hide();\n    } else {\n      \t$('.showDeal').show();\n    }\n    if (showLinkedContacts === 'no'){\n    \t$('.activity-contact').hide();\n      \t$('#activity-linked-person').attr('data-id', person_id);\n        $('#activity-linked-organization').attr('data-id', org_id);\n      \t$('#activity-linked-deal').attr('data-id', deal_id);\n        alert($('#activity-linked-deal').attr('data-id'));\n    } else {\n    \t$('.activity-contact').show();\n    }\n  \tvar finalText = \"Done\";\n    if (!isNew){\n        getDetailsForActivity(activityID);\n      \tfinalText = \"Edit\";\n    }\n    link();\n    formelo.html().get.header.title().html(isNew ? 'Add Activity' : 'Edit Activity');\n    \n\tformelo.html().get.header.menu().html(finalText).show().click(function(){\n      \tif (isNew){\n          \taddActivity();\n        } else {\n          \tupdateActivity();\n        }\n      \t\n    });\n});"
            }
        },
        {
            "layout": "",
            "css": "",
            "name": "Filter",
            "resources": ""
        },
        {
            "layout": "<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Choose Person</label>\n\t<input readonly=\"readonly\" id=\"deal-persons\" placeholder=\"Choose Person\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Choose Organization </label>\n\t<input readonly=\"readonly\" placeholder=\"Choose Organization\" id=\"deal-organization\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default required\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Deal Title</label>\n\t<input id=\"deal-title\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Deal Value</label>\n\t<input id=\"deal-value\" type=\"number\" class=\"form-control\"/>\n</div>\n\n",
            "css": "",
            "name": "Add a new Deal",
            "resources": "",
            "events": {
                "ready": "var modalController = formelo.require('modalController');\nvar notif = formelo.require('notif');\nvar mode = 'add';\nvar deal = null;\nvar addDeal = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/deals?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar title = $('#deal-title').val();\n    var value = $('#deal-value').val();\n    var org = $('#deal-organization').attr('data-id');\n    var user = $('#deal-person').attr('data-id');\n    var data = {\n      title : title,\n      value : value, \n      person_id : user, \n      org_id : org\n    };\n   showMessage(\"Posting...\");\n   notif.show();\n   $.when(fetchData(endPoint, data, \"POST\"))\n   .done(function(data){\n     \tnotif.hide();\n     \tshowMessage('Your Deal has been created.');\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(){\n     \tnotif.hide();\n     \tshowMessage(\"Deal could not be created. Please try again later.\");\n    });\n};\n\nvar updateDeal = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/deals/\"+id+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar title = $('#deal-title').val();\n    var value = $('#deal-value').val();\n    var org = $('#deal-organization').attr('data-id');\n    var user = $('#deal-persons').attr('data-id');\n    var data = {\n      title : title,\n      value : value, \n      person_id : user, \n      org_id : org\n    };\n   showMessage(\"Updating...\");\n   notif.show();\n   $.when(fetchData(endPoint, data, \"PUT\"))\n   .done(function(data){\n     \tnotif.hide();\n     \tshowMessage('Your Deal has been Updated.');\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(){\n     \tnotif.hide();\n     \tshowMessage(\"Deal could not be upated. Please try again later.\");\n    });\n};\n\n\n\nfunction getDetailsForDeal(id){\n\t     var endPoint = 'https://api.pipedrive.com/v1/deals/'+id+'?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n  \t\t$.when(fetchData(endPoint))\n        .done(function(data){\n             var result = data.data;\n        \t  \t$('#deal-organization').val(result.org_id ? result.org_id.name : '').attr('data-id', result.org_id ? result.org_id.value : '');\n                $('#deal-persons').val(result.person_id ? result.person_id.name : '').attr('data-id', result.person_id ? result.person_id.value : '');\n                $('#deal-title').val(result.title);\n                $('#deal-value').val(result.value);\n        })\n        .fail(function(err){\n            alert(JSON.stringify(err));\n          \tshowMessage('Error occured while displaying data.');\n        });\n}\n\n\nfunction link(){\n\t$('#deal-persons').click(function(){\n        formelo.navigation().openActivity(17);\n    });\n    $('#deal-organization').click(function(){\n    \tformelo.navigation().openActivity(18);\n    });\n}\n\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'persons'){\n    \t$('#deal-person').val(data.detail.name).attr('data-id', data.detail.id);\n    } else if (data.detail.type === 'organizations'){\n    \t$('#deal-organization').val(data.detail.name).attr('data-id', data.detail.id);\n    }\n});\n\n\nfunction reset(){\n\t$('#deal-persons').val('').attr('data-id', '');\n    $('#deal-organization').val('').attr('data-id', '');\n    $('#deal-title').val('');\n    $('#deal-value').val('');\n}\nvar id = null;\nvar isNew = true;\n\nformelo.event().onIntent(function(data){\n\tid = data.detail.id;\n    isNew = data.detail.isNew;\n  \tmode = data.detail.mode ? data.detail.mode : 'new';\n    //deal = data.detail.deal;\n  \talert(id);\n});\n\nformelo.event().onCreate(function(){\n    reset();\n    var finalText = \"Done\";\n    if (!isNew){\n        getDetailsForDeal(id);\n        finalText = \"Edit\";\n    }\n    link();\n    formelo.html().get.header.title().html(isNew ? 'Add Deal' : 'Edit Deal');\n  \tformelo.html().get.header.menu().html(finalText).show().click(function(){\n        if (isNew){\n        \taddDeal();\n        } else {\n        \tupdateDeal();\n        }\n    });\n});"
            }
        },
        {
            "layout": "<div>\n\t<div class=\"card share full-height no-margin-card\" data-social=\"item\">\n\t<div class=\"card-header clearfix Sv8OzZm2qNpieKvIYvZq\" unique=\"asshole\">\n\t\t<div class=\"user-pic pull-left\"><img id=\"details-image\" alt=\"Profile Image\" width=\"33\" height=\"33\" src=\"img/loading.png\"></div>\n\t\t<h6 id=\"details-time\" style=\"float: right; font-size: xx-small; display: inline;\"></h6>\n\t\t<div style=\"margin-left: 40px\">\n\t\t\t<h5 id=\"details-name\" style=\"font-weight: 300;\">Loading</h5>\n\t\t\t<h6 id=\"details-description\"></h6>\n\t\t</div>\n\t</div>\n</div>\n</div>\n\n<div>\n\n<div id=\"deal-stats\" class=\"row\" style=\"height: 9vh;max-height: 9vh;overflow: hidden;\">\n\t\n</div>\n\n\n\t<ul class=\"nav nav-tabs nav-tabs-simple nav-tabs-up bg-white\" id=\"tab-3\">\n\t\t<li class=\"active\" style=\"width:33%;\">\n\t\t\t<a style=\"text-align:center;\" data-toggle=\"tab\" href=\"#detail-flow\" aria-expanded=\"false\">Activities</a>\n\t\t</li>\n\t\t<li style=\"width:33%;\">\n\t\t\t<a style=\"text-align:center;\" data-toggle=\"tab\" href=\"#detail-details\" aria-expanded=\"true\">Details</a>\n\t\t</li>\n        <li style=\"width:33%;\">\n\t\t\t<a style=\"text-align:center;\" data-toggle=\"tab\" href=\"#detail-files\" aria-expanded=\"true\">Files</a>\n\t\t</li>\n\t</ul>\n\t<div class=\"tab-content bg-white\" style=\"\n\t\theight: 70vh;\">\n\t\t<div class=\"tab-pane active\" id=\"detail-flow\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">No Activity</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"tab-pane\" id=\"detail-details\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n        <div class=\"tab-pane\" id=\"detail-files\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
            "css": "",
            "name": "Deal Details",
            "resources": "",
            "events": {
                "ready": "var deal_id = null;\nvar person_id = null;\nvar org_id = null;\n\nvar sendFile = formelo.require('sendFile');\nvar modalController = formelo.require('modalController');\nvar numberWithCommas = formelo.require('numberWithCommas');\nvar activityMap = formelo.require('activityMap');\nvar fileMap = formelo.require('fileMap');\nvar notif = formelo.require('notif');\nvar loadingHtml = formelo.require('loadingHtml');\n\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n  \t\t\t{\n                'icon' : 'fa fa-close',\n                'text' : 'Delete',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'delete'\n            },\n  \t\t\t {\n                'icon' : 'fa  fa-plus',\n                'text' : 'Add',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'add'\n            }\n];\n\nvar add = function(buttonIndex){\n  \t\t\tif (buttonIndex == 'note'){\n              \tvar dat = {\n                   \t\tdeal_id : id,\n                        person_id : person_id,\n                        org_id : org_id\n                };\n            \tformelo.navigation().openActivity(2, dat);\n            } else if (buttonIndex == 'activity'){\n                if (person_id !== null){\n                   var dat = {\n                   \t\tdeal_id : id,\n                        person_id : person_id,\n                        org_id : org_id, \n                     \tshowDeal : 'no',\n                     \tshowLinkedContacts : 'no', \n                     \tisNew : true\n                   };\n                   alert(JSON.stringify(dat));\n                   formelo.navigation().openActivity(3, dat);\n                }\n            } else if (buttonIndex == 'deal') {\n            \t if (person_id !== null){\n                   var dat = {\n                   \t\tdeal_id : id,\n                        person_id : person_id,\n                        org_id : org_id\n                   };\n                   formelo.navigation().openActivity(5, dat);\n                }\n            } else if (buttonIndex == 'audio') {\n            \tif (person_id !== null){\n                  formelo.navigation().openActivity(12, {person_id : person_id, deal_id : deal_id, org_id : org_id});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            } else if (buttonIndex == 'photo'){\n            \tformelo.hooks.getImage(function(data){\n                  \tsendFile(data, person_id, deal_id, null, function(){\n                    \tgetFilesForDeal(id);\n                    });\n                }, function(err){\n                \tshowMessage(JSON.stringify(err));\n                });\n            }\n};\n\nfunction updateDealStatus (){\n\t$(\"#deals-lost\").click(function(){\n        if (deal_id){\n            updateDeal(deal_id, 'lost');\n        }\n    });\n  \t$(\"#deals-won\").click(function(){\n      \tif (deal_id){\n    \t\tupdateDeal(deal_id, 'won');\n        }\n    });\n  \t$(\"#deals-open\").click(function(){\n      \tif (deal_id){\n    \t\tupdateDeal(deal_id, 'open');\n        }\n    });\n}\n\nfunction updateDeal(dealID, status){\n\tvar data = {\n    \tid : id,\n      \tstatus : status\n    };\n   var endPoint = \"https://api.pipedrive.com/v1/deals/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tshowMessage(\"Updating...\");\n    $.when(fetchData(endPoint, data, \"PUT\"))\n    \t.done(function(data){\n            //alert(JSON.stringify(data));\n    \t\tvar html = ''+\n                '<div class=\"col-xs-4\" style=\"border-left: 1px solid #ecf0f1;'+\n            'background-color: grey\">'+\n            \t'<p id=\"deals-open\" style=\"color: white;'+\n                'vertical-align: middle;'+\n                'line-height: 9vh;'+\n                'text-align: center;\">'+status+'</p>'+\n        \t\t'</div>';\n            $('.deal-statuses').remove();\n      \t\t$('#deal-stats').append(html);\n      \t\t//if (status === 'open'){\n            \tgetDetailsForDeal(id);\n            //}\n      \t\tupdateDealStatus();\n    \t})\n    \t.fail(function(){\n    \t\tshowMessage(\"An error has occured. Try again.\");\n    \t});\t\n}\n\nfunction showOptions(){\n  \t\tvar options = [\n  {\n  \tunique : 'activity',\n    name : 'Activity',\n    image : 'http://img3.cliparto.com/pic/s/196419/4423411-men-sign.jpg'\n  }, \n  {\n  \tunique : 'note',\n    name : 'Note',\n    image : 'http://a2.mzstatic.com/us/r30/Purple60/v4/62/2e/eb/622eeb3f-2caf-83f8-e49a-a4fb366659b4/icon100x100.png'\n  }, \n  {\n  \tunique : 'photo',\n    name : 'Photo',\n    image : 'http://www.bodycharity.co.uk/images/flatin.png'\n  }, \n  {\n  \tunique : 'audio',\n    name : 'Audio Note',\n    image : 'http://img5.cliparto.com/pic/s/256180/5107668-microphone-web-icon-flat-design.jpg'\n  }, \n  {\n  \tunique : 'cancel',\n    name : 'Cancel',\n    image : 'https://i.downloadatoz.com/download/icon2/6/a/5/b5b33b4c9ebcdf57be7c09dceb4465a6.jpg'\n  }];\n  //if (formelo.currentIndex === 6){\n  \t\tvar id = str_random(20);\n\t\t//var aa = new modalController();\n    \tvar mod = formelo.ui().modal('options','<div id=\"'+id+'\"></div>', 'Options');\n      \tformelo.ui().listAdapter(options, '#'+id).attach(function(item){\n    \t\tmod.close();\n          \tadd(item);\n    \t});\n  //}\n}\nvar id = null;\n\nvar getFilesForDeal =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/deals/\"+dealID+\"/files?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#detail-files').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.name,\n                  'description' : moment(item.add_time).fromNow(),\n                  'unique' : item.url+'|'+item.id,\n                  'image' : 'img/loading.png'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#detail-files').attach(function(item){\n                // Open inappbrowser\n              \tvar selected = item.split('|');\n              var link = selected[0]+'?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n              alert(link);\n              formelo.navigation().openBrowser(link);\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Files</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#detail-files').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#detail-files').html(errorHtml);\n    });\n};\n\nvar getActivityForDeal =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/deals/\"+dealID+\"/activities?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#detail-flow').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.subject,\n                  'description' : item.due_date + ' '+ item.due_time + ' - ' + item.person_name,\n                  'unique' : item.id,\n                  'image' : activityMap[item.type]['icon']\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#detail-flow').attach(function(item){\n                formelo.navigation().openActivity(3, {isNew: false, activityID : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Flows</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#detail-flow').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#detail-flow').html(errorHtml);\n    });\n};\n\n\nvar getDetailsForDeal =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/deals/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    $('#detail-details').html(loadingHtml);\n    $('#deal-stats').html('');\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar item = data.data;\n        var resArr = [];\n        deal_id = item.id;\n        person_id = item.person_id.value;\n        org_id = item.org_id.value;\n        $('#details-name').html(item.title);\n        //$('#details-price').html(item.formatted_value);\n        $('#details-description').html('<i class=\"fa fa-user\"></i> &nbsp;'+item.person_id.name + ' &nbsp;&nbsp;&nbsp;<i class=\"fa fa-building\"></i> &nbsp;' + item.org_id.name);\n        $('#details-image').attr('src','img/bg/'+item.org_id.name.trim().charAt(0).toUpperCase()+'.gif');\n      \n        var html = '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Owner</p> <p>'+item.creator_user_id.name+'</p> <hr>';\n        html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Created</p> <p>'+moment(item.add_time).fromNow()+'</p> <hr>';\n        html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Last Updated</p> <p>'+moment(item.update_time).fromNow()+'</p> <hr>';\n        html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Email BCC</p> <p>'+item.cc_email+'</p> <hr>';\n        html += '<div id=\"deal-person\"><p data-id=\"'+item.person_id.value+'\" style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Participants (Tap to open)</p> <p>'+item.person_id.name+'</p> <hr></div>';\n      \t    \n     html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Priority</p> <p>'+(item['fca7450f052c406f834126b23d853db9dc05f08d'] ? item['fca7450f052c406f834126b23d853db9dc05f08d'] : '')+'</p> <hr>';\n      \t$('#detail-details').html(html); \n        \n  \tvar dealStatusHtml = ''+    \n      '<div class=\"col-xs-8\">'+\n\t\t\t'<p style=\"vertical-align:middle;'+\n\t\t\t'line-height: 9vh;'+\n\t\t\t'font-size: large;'+\n\t\t\t'font-weight: bolder;'+\n            'margin-left: 6%;\">'+item.formatted_value+'</p>'+\n\t\t'</div>';\n      \n      if (item.status !== 'open'){\n      \tdealStatusHtml += ''+\n          '<div class=\"col-xs-4\" style=\"border-left: 1px solid #ecf0f1;'+\n\t\t'background-color: grey;\">'+\n\t\t'<p id=\"deals-open\" style=\"color: white;'+\n\t\t\t'vertical-align: middle;'+\n\t\t\t'line-height: 9vh;'+\n\t\t\t'text-align: center;\">'+item.status+'</p>'+\n\t\t'</div>';\n      } else {\n      \tdealStatusHtml += ''+\n          '<div class=\"col-xs-2 deal-statuses\" style=\"border-left: 1px solid #ecf0f1;'+\n\t\t'background-color: #1abc9c;\">'+\n\t\t'<p id=\"deals-won\" style=\"color: white;'+\n\t\t\t'vertical-align: middle;'+\n\t\t\t'line-height: 9vh;'+\n\t\t\t'text-align: center;\">Won</p>'+\n        '</div>'+\n        '<div class=\"col-xs-2 deal-statuses\" style=\"border-left: 1px solid #ecf0f1;'+\n            'background-color: #e74c3c\">'+\n            '<p id=\"deals-lost\" style=\"color: white;'+\n                'vertical-align: middle;'+\n                'line-height: 9vh;'+\n                'text-align: center;\">Lost</p>'+\n        '</div>';\n      }\n      $('#deal-stats').html(dealStatusHtml);\n     \n      updateDealStatus();\n      openPerson();    \n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#detail-details').html(errorHtml);\n    });\n};\n\nfunction openPerson(id){\n  \t$('#deal-person').click(function(){\n      \tvar id = $(this).attr('data-id');\n    \tformelo.navigation().openActivity(8, {id:id});\n    });\n}\n\nfunction showLoading(){\n\t$('#details-name').html(' ');\n    $('#details-image').html(' ');\n    $('#details-description').html(' ');\n    $('#details-time').html(' ');\n}\n\n\nformelo.event().onIntent(function(data){\n  id = data.detail.id;\n  \n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tshowLoading();\n        getActivityForDeal(id);\n        getDetailsForDeal(id);\n        getFilesForDeal(id);\n    }\n});\n\nfunction deleteItem(){\n\tvar endPoint = \"https://api.pipedrive.com/v1/deals/\"+id+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n            notif.show();\n           $.when(fetchData(endPoint, {}, \"DELETE\"))\n           .done(function(data){\n                notif.hide();\n                showMessage('Deleted.');\n                formelo.navigation().result({type : 'reload'});\n           })\n           .fail(function(e){\n                notif.hide();\n                alert(JSON.stringify(e));\n                showMessage('Could not contact the server.');\n           });\n}\n\nformelo.event().onCreate(function(){\n  formelo.ui().footer(footer, function(item){\n    if (item === 'delete'){\n    \tdeleteItem();\n    } else {\n    \tshowOptions();\n    }\n  });\n  showLoading();\n  getActivityForDeal(id);\n  getDetailsForDeal(id);\n  getFilesForDeal(id);\n  formelo.html().get.header.menu().html('Edit').show().click(function(){\n    \tformelo.navigation().openActivity(5, {mode: 'update', id:deal_id, isNew:false});\n  });\n  \n});"
            }
        },
        {
            "layout": "<div class=\"row\" style=\"padding: 1% 3%;\">\n\t<div class=\"input-group transparent\">\n                    <span id=\"contact-filter\" class=\"input-group-addon\"><i class=\"fa fa-filter\"></i></span>\n                    <input type=\"text\" class=\"form-control\" id=\"contact-search\" placeholder=\"Search for people\" style=\"font-size:small !important;\"/>\n                    <span id=\"contact-map\" class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\n                </div>\n</div>\n\n<div id=\"userlist\">\n</div>",
            "css": "",
            "name": "Contacts",
            "resources": "",
            "events": {
                "ready": "var items = [];\nvar type = 'main';\nvar filter_id = null;\nvar loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n   {\n                'icon' : 'fa fa-dollar',\n                'text' : 'Deals',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'deals'\n            },\n  {\n                'icon' : 'fa fa-calendar-o',            \n                'text' : 'Activities',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'activity'\n            },\n  {\n                'icon' : 'fa fa-user',\n                'text' : 'Contacts',\n                'link' : null,\n                'active' :  true,\n                'unique' : 'contacts'\n            },\n  {\n                'icon' : 'fa fa-building',\n                'text' : 'Organizations',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'organization'\n            }\n];\n\n\n\nvar getUsers = function(){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/persons?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    var data = {\n    \tfilter_id : filter_id,\n         sort : 'name ASC'\n    };\n  \t$('#userlist').html(loadingHtml);\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        if (!result || !result.length){\n        \treturn false;\n        }\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'description' : item.org_id ? item.org_id.name : '',\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif',  \n                'time' : item.owner_id.active_flag ? 'active' : 'inactive'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#userlist').attach(function(item){\n    \t\tformelo.navigation().openActivity(8, {id : item});\n    \t});\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#userlist').html(errorHtml);\n    });\n  \tfilter_id = null;\n};\nvar searchUsers = function(searchTerm){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/persons/find?term=dan&start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    var data = {\n    \tterm : searchTerm\n    };\n  \t$('#userlist').html(loadingHtml);\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n      \tif (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.name,\n                  'description' : item.org_id ? item.org_name : '',\n                  'unique' : item.id,\n                  'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#userlist').attach(function(item){\n                formelo.navigation().openActivity(8, {id : item});\n            });\n        } else {\n        \t$('#userlist').html('');\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#userlist').html(errorHtml);\n    });\n};\nvar handleItem = function(item){\n  formelo.navigation().openActivity(1);\n};\n\nvar handleMenu = function(item){\n  if (item === 'contacts') {\n  \t formelo.navigation().openActivity(7);\n  } else  if (item === 'activity'){\n  \t formelo.navigation().openActivity(9);\n  } else  if (item === 'deals'){\n  \t formelo.navigation().openActivity(0);\n  } else if (item === 'organization') {\n  \t formelo.navigation().openActivity(20);\n  }\n};\n\nformelo.event().onIntent(function(data){\n\tfilter_id = data.detail.filter_id;\n});\n\nformelo.event().onCreate(function(){\n    formelo.html().get.header.menu().html('Add').show().click(function(){\n    \tformelo.navigation().openActivity(13, {isNew: true});\n    });\n    $('#contact-filter').unbind().click(function(){\n       formelo.navigation().openActivity(16);                                   \n    });\n    $('#contact-map').unbind().click(function(){\n       formelo.navigation().openActivity(11, {users : items});                              \n    });\n    $('#contact-search').unbind().on('change', function(){\n      var val = $(this).val();\n      if (val && val.length >= 3){\n       \t searchUsers(val);\n      }\n    });\n\tformelo.ui().footer(footer, function(item){\n    \thandleMenu(item);\n    });\n    getUsers(); \n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetUsers(); \n    }\n});\n\nformelo.event().onClose(function(data){\n  formelo.navigation().stopPropagation();\n  navigator.notification.confirm(\n    \t'', \n      \tfunction(buttonIndex){\n        \tif (buttonIndex == 1){\n            \tformelo.close();               \n            }\n        },\n      \t'Exit?', \n      \t['Yes', 'Cancel'],\n      \t''\n    );\n});"
            }
        },
        {
            "layout": "<div>\n\t<div class=\"card share full-height no-margin-card\" data-social=\"item\">\n\t<div class=\"card-header clearfix Sv8OzZm2qNpieKvIYvZq\" unique=\"asshole\">\n\t\t<div class=\"user-pic pull-left\"><img id=\"user-image\" alt=\"Profile Image\" width=\"33\" height=\"33\" src=\"img/loading.png\"></div>\n\t\t<h6 id=\"user-time\" style=\"float: right; font-size: xx-small; display: inline;\"></h6>\n\t\t<div style=\"margin-left: 40px\">\n\t\t\t<h5 id=\"user-name\" style=\"font-weight: 300;\">Loading</h5>\n\t\t\t<h6 id=\"user-description\"></h6>\n\t\t</div>\n\t</div>\n</div>\n</div>\n\n<div>\n\t<ul class=\"nav nav-tabs nav-tabs-simple nav-tabs-up bg-white\" id=\"tab-3\">\n\t\t<li class=\"\" style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#user-details\" aria-expanded=\"false\">Details</a>\n\t\t</li>\n\t\t<li class=\"active\" style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#user-flows\" aria-expanded=\"true\">Activities</a>\n\t\t</li>\n        <li style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#user-deals\" aria-expanded=\"true\">Deals</a>\n\t\t</li>\n        <li style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#user-files\" aria-expanded=\"true\">Files</a>\n\t\t</li>\n\t</ul>\n\t<div class=\"tab-content bg-white\" style=\"\n\t\theight: 70vh;max-height:height: 70vh; overflow:scroll\">\n\t\t<div class=\"tab-pane\" id=\"user-details\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">No Activity</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"tab-pane active\" id=\"user-flows\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n        <div class=\"tab-pane active\" id=\"user-deals\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n        <div class=\"tab-pane active\" id=\"user-files\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
            "css": "",
            "name": "Contact Details",
            "resources": "",
            "events": {
                "ready": "var personID = null;\nvar orgID  = null;\nvar modalController = formelo.require('modalController');\nvar activityMap = formelo.require('activityMap');\nvar notif = formelo.require('notif');\nvar sendFile = formelo.require('sendFile');\nvar loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n  \t\t\t{\n                'icon' : 'fa fa-close',\n                'text' : 'Delete',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'delete'\n            },\n   \t\t\t{\n                'icon' : 'fa fa-plus',\n                'text' : 'Add',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'add'\n            }\n];\n\n\n\nvar add = function(buttonIndex){\n  \t\t   if (buttonIndex == 'note'){\n              if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(2, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            \tformelo.navigation().openActivity(2);\n            } else if (buttonIndex == 'activity'){\n                if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(3, {person_id : personID, org_id : orgID, showLinkedContacts : 'no'});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            \t\n            } else if (buttonIndex == 'deal') {\n              if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(5, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            } else if (buttonIndex == 'audio') {\n                if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(12, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            } else if (buttonIndex == 'photo'){\n            \tformelo.hooks.getImage(function(data){\n                  \tsendFile(data, personID, null, null, function(){\n                    \tgetFilesForUser(id);\n                    });\n                }, function(err){\n                \tshowMessage(JSON.stringify(err));\n                });\n            }\n};\n\n\nfunction showOptions(){\n  \t\tvar options = [\n  {\n  \tunique : 'activity',\n    name : 'Activity',\n    image : 'http://img3.cliparto.com/pic/s/196419/4423411-men-sign.jpg'\n  }, \n          {\n  \tunique : 'deal',\n    name : 'Deal',\n    image : 'http://img5.cliparto.com/pic/s/256180/5517229-money-icon-flat-design-style.jpg'\n  }, \n  {\n  \tunique : 'note',\n    name : 'Note',\n    image : 'http://a2.mzstatic.com/us/r30/Purple60/v4/62/2e/eb/622eeb3f-2caf-83f8-e49a-a4fb366659b4/icon100x100.png'\n  }, \n  {\n  \tunique : 'photo',\n    name : 'Photo',\n    image : 'http://www.bodycharity.co.uk/images/flatin.png'\n  }, \n  {\n  \tunique : 'audio',\n    name : 'Audio Note',\n    image : 'http://img5.cliparto.com/pic/s/256180/5107668-microphone-web-icon-flat-design.jpg'\n  }, \n  {\n  \tunique : 'cancel',\n    name : 'Cancel',\n    image : 'https://i.downloadatoz.com/download/icon2/6/a/5/b5b33b4c9ebcdf57be7c09dceb4465a6.jpg'\n  }];\n    \n//if (formelo.currentIndex === 8){\n  \t\tvar id = str_random(20);\n\t\tvar mod = formelo.ui().modal('Options','<div id=\"'+id+'\"></div>');\n      \tformelo.ui().listAdapter(options, '#'+id).attach(function(item){\n    \t\tmod.close();\n          \tadd(item);\n    \t});\n// }\n}\n\n\nvar id = null;\n\n\n\nvar getActivityForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/persons/\"+dealID+\"/activities?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#user-flows').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.subject,\n                  'description' : item.due_date + ' '+ item.due_time + ' - ' + item.owner_name,\n                  'unique' : item.id,\n                  'image' : activityMap[item.type]['icon']\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#user-flows').attach(function(item){\n                formelo.navigation().openActivity(3, {isNew: false, activityID : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Flows</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#user-flows').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#user-flows').html(errorHtml);\n    });\n};\nvar getDealsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/persons/\"+dealID+\"/deals?start=0&status=all_not_deleted&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#user-deals').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.title,\n                  'description' : item.formatted_value,\n                  'unique' : item.id,\n                  'image' : 'img/bg/'+item.title.trim().charAt(0).toUpperCase()+'.gif'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#user-deals').attach(function(item){\n                formelo.navigation().openActivity(6, {id : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Deals</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#user-deals').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#user-deals').html(errorHtml);\n    });\n};\nvar getFilesForUser =  function (userID){\n  var endPoint = \"https://api.pipedrive.com/v1/persons/\"+userID+\"/files?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#user-files').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.name,\n                  'description' : moment(item.add_time).fromNow(),\n                  'unique' : item.url+'|'+item.id,\n                  'image' : 'img/loading.png'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#user-files').attach(function(item){\n                // Open inappbrowser\n              \tvar selected = item.split('|');\n              var link = selected[0]+'?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n            \n              formelo.navigation().openBrowser(link);\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Files</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#user-files').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#user-files').html(errorHtml);\n    });\n};\nvar getDetailsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/persons/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    $('#user-details').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar item = data.data;\n        var resArr = [];\n        personID = item.id;\n        orgID = item.org_id ? item.org_id.value : null;\n        $('#user-name').html(item.name);\n        $('#user-description').html(item.org_name ? item.org_name : '');\n        $('#user-image').attr('src','img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif');\n      \n        var html = '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Work Address</p> <p>'+item['0d408096edbdf5a2490214ab299b006c564f173c']+'</p> <hr>';\n        html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Basic Salary</p> <p>'+item['734552c98a44501b5f1c83ff03a138f3d82f9338']+'</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Priority</p> <p>'+item['fca7450f052c406f834126b23d853db9dc05f08d']+'</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Savings Account</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Current Account</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Salary Loan</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Life Insurance</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">Car Insurance</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">RSA Account</p> <p>Not specified</p> <hr>';\n      \n      html += '<p style=\"color:grey; font-size: x-small; margin-bottom: -1%\">VC Account</p> <p>Not specified</p> <hr>';\n      \n      \t$('#user-details').html(html);      \n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#user-details').html(errorHtml);\n    });\n};\n\n\nvar sidemenu = [\n  {\n  \tunique : 'edit',\n    text : 'Edit',\n    icon : 'fa fa-edit'\n  },\n  {\n  \tunique : 'activity',\n    text : 'Activity',\n    icon : 'fa fa-calendar'\n  }, \n  {\n  \tunique : 'note',\n    text : 'Note',\n    icon : 'pg-note'\n  }, \n  {\n  \tunique : 'photo',\n    text : 'Photo',\n    icon : 'fa fa-photo'\n  }, \n  {\n  \tunique : 'audio',\n    text : 'Audio Note',\n    icon : 'fa fa-microphone'\n  }, {\n  \tunique : 'cancel',\n    text : 'Cancel',\n    icon : 'pg-more'\n  }\n];\n\n\nformelo.event().onIntent(function(data){\n  id = data.detail.id;\n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetActivityForUser(id);\n        getDetailsForUser(id);\n        getDealsForUser(id);\n        getFilesForUser(id);\n    }\t\n});\n\nfunction deleteItem() {\n\tvar endPoint = \"https://api.pipedrive.com/v1/persons/\"+id+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n            notif.show();\n           $.when(fetchData(endPoint, {}, \"DELETE\"))\n           .done(function(data){\n                notif.hide();\n                showMessage('Deleted.');\t\n                formelo.navigation().result({type : 'reload'});\n           })\n           .fail(function(e){\n                notif.hide();\n                alert(JSON.stringify(e));\n                showMessage('Could not contact the server.');\n           });\n}\n\n\nformelo.event().onCreate(function(){\n  formelo.html().get.header.menu().html('Edit').show().click(function(){\n    \tformelo.navigation().openActivity(13, {isNew: false, id : id});\n    });\n  formelo.ui().footer(footer, function(item){\n      if (item === 'delete'){\n          deleteItem();\n      } else {\n          showOptions();\n      }\n  });\n  getActivityForUser(id);\n  getDetailsForUser(id);\n  getDealsForUser(id);\n  getFilesForUser(id);\n});"
            }
        },
        {
            "layout": "\n\n<div id=\"activitylist\">\n</div>",
            "css": "",
            "name": "Activities",
            "resources": "",
            "events": {
                "ready": "var type = 'main';\nvar filter_id = null;\nvar activityMap = formelo.require('activityMap');\nvar loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n   {\n                'icon' : 'fa fa-dollar',\n                'text' : 'Deals',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'deals'\n            },\n  {\n                'icon' : 'fa fa-calendar-o',            \n                'text' : 'Activities',\n                'link' : null,\n                'active' :  true,\n                'unique' : 'activity'\n            },\n  {\n                'icon' : 'fa fa-user',\n                'text' : 'Contacts',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'contacts'\n            },\n  {\n                'icon' : 'fa fa-building',\n                'text' : 'Organizations',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'organization'\n            }\n];\n\n\n\nvar getActivity = function(){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/activities?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \t$('#activitylist').html(loadingHtml);\n  \tvar data = {\n    \tfilter_id : filter_id\n    };\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        result.forEach(function(item){\n        \tresArr.push({\n\t\t\t\t'name' : item.subject,\n                'description' : moment(item.due_date).format('ddd, Do MMM') + ' '+ item.due_time+ ' - ' + item.person_name,\n                'unique' : item.id,\n                'image' : activityMap[item.type]['icon']\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#activitylist').attach(function(item){\n    \t\tformelo.navigation().openActivity(3, {activityID : item, isNew : false});\n    \t});\n    })\n    .fail(function(e){\n    \talert(JSON.stringify(e));\n        $('#activitylist').html(errorHtml);\n    });\n};\nvar handleItem = function(item){\n  formelo.navigation().openActivity(1);\n};\nvar handleMenu = function(item){\n  if (item === 'contacts') {\n  \t formelo.navigation().openActivity(7);\n  } else  if (item === 'activity'){\n  \t formelo.navigation().openActivity(9);\n  } else  if (item === 'deals'){\n  \t formelo.navigation().openActivity(0);\n  } else if (item === 'organization') {\n  \t formelo.navigation().openActivity(20);\n  }\n};\n\n\nformelo.event().onIntent(function(data){\n\tfilter_id = data.detail.filter_id;\n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetActivity(); \n    }\n});\n\nformelo.event().onCreate(function(){\n    formelo.html().get.header.menu().html('Add').show().click(function(){\n    \tformelo.navigation().openActivity(3);\n    });\n\tformelo.ui().footer(footer, function(item){\n    \thandleMenu(item);\n    });\n    $('#activity-filter').click(function(){\n    \tformelo.navigation().openActivity(15);\n    });\n    getActivity(); \n});\n\nformelo.event().onClose(function(data){\n  formelo.navigation().stopPropagation();\n  navigator.notification.confirm(\n    \t'', \n      \tfunction(buttonIndex){\n        \tif (buttonIndex == 1){\n            \tformelo.close();               \n            }\n        },\n      \t'Exit?', \n      \t['Yes', 'Cancel'],\n      \t''\n    );\n});"
            }
        },
        {
            "layout": "<div style=\"height: 100vh; max-height: 100vh; overflow:scroll;\npadding: 2%;\nbackground-color: #2c3e50;\">\n\n\n<div>\n\n<input placeholder=\"search\" id=\"lyrics-search\" class=\"form-control\" type=\"text\" style=\"background-color: #2c3e50;\nborder: none; border-bottom: 1px solid white;color: white;\">\n\n</div><br>\n<div id=\"lyrics-suggestion\">\n\n  <div class=\"row\">\n      <div class=\"col-xs-3\"></div>\n      <div class=\"col-xs-6\" style=\"text-align: center;\">\n        <p style=\"color: white;font-size: smaller;\">RECENT</p><br><br>\n        \n\t  </div>\n      <div class=\"col-xs-3\"></div>\n  </div>\n  \n</div>\n\n</div>\n",
            "css": "",
            "name": "Search",
            "resources": "",
            "events": {
                "ready": "var footer = [\n   {\n                'icon' : 'fa fa-dollar',\n                'text' : 'Deals',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'deals'\n            },\n  {\n                'icon' : 'fa fa-calendar-o',            \n                'text' : 'Activities',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'activity'\n            },\n  {\n                'icon' : 'fa fa-user',\n                'text' : 'Contacts',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'contacts'\n            },\n  {\n                'icon' : 'fa fa-search',\n                'text' : 'Search',\n                'link' : null,\n                'active' :  true,\n                'unique' : 'search'\n            },\n  {\n                'icon' : 'pg-more',\n                'text' : 'More',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'more'\n            }\n];\n\nvar handleMenu = function(item){\n  if (item === 'contacts') {\n  \t formelo.navigation().openActivity(7);\n  } else  if (item === 'activity'){\n  \t formelo.navigation().openActivity(9);\n  } else  if (item === 'deals'){\n  \t formelo.navigation().openActivity(0);\n  } else if (item === 'search') {\n  \t formelo.navigation().openActivity(10);\n  }\n};\n\nformelo.event().onCreate(function(){\n\tformelo.ui().footer(footer, function(item){\n    \thandleMenu(item);\n    });\n});\n\nformelo.event().onClose(function(data){\n  formelo.navigation().stopPropagation();\n  navigator.notification.confirm(\n    \t'', \n      \tfunction(buttonIndex){\n        \tif (buttonIndex == 1){\n            \tformelo.close();               \n            }\n        },\n      \t'Quit?', \n      \t['Exit Applet', 'Cancel'],\n      \t'?'\n    );\n});"
            }
        },
        {
            "layout": "<div id=\"mymap\" style=\"height:100vh\"></div>",
            "css": "",
            "name": "Map",
            "resources": "",
            "events": {
                "ready": "function openUser(id){\n\tformelo.navigation.openActivity(8, {id:id});\n}\nvar showMap = function(dataArr){\n\tvar myLatLng = {lat: 6.5569563, lng: 3.357436};\n\n  var map = new google.maps.Map(document.getElementById('mymap'), {\n    zoom: 12,\n    center: myLatLng\n  });\n\n  var marker = new google.maps.Marker({\n    position: myLatLng,\n    map: map,\n    title: 'Hello World!'\n  });\n  marker.setMap(map);\n  dataArr.forEach(function(item){\n    if (item['749c9691125047f8865302960302d325ccf7efd2'] && item['66f7539b280bebcc93b39757b5581d88a30c8646']){\n      var latLng = {lat: item['66f7539b280bebcc93b39757b5581d88a30c8646'], lng: item['749c9691125047f8865302960302d325ccf7efd2']};\n      var marker = new google.maps.Marker({\n        position: latLng,\n        map: map,\n        title: 'Hello World!'\n      });\n      marker.setMap(map);\n      var contentString = '<div data-id=\"'+item.id+'\" id=\"mapcontent\">'+\n            '<div id=\"siteNotice\">'+\n            '</div>'+\n            '<h5>'+item.name+'</h5>'+\n            '<h6>'+item.org_name+'</h6><hr>'+ \n            '<p style=\"color:grey;\">'+item['0d408096edbdf5a2490214ab299b006c564f173c']+'</p><hr>'+ \n            '<button class=\"btn btn-xs btn-complete mapitem\" data-id=\"'+item.id+'\">View Contact Detail</p>'+ \n            '</div>'+\n            '</div>';\n       var infowindow = new google.maps.InfoWindow({\n          content: contentString\n       });\n       marker.addListener('click', function() {\n          infowindow.open(map, marker);\n       });\n      \n       google.maps.event.addListener(infowindow,'domready',function(){\n          $('#mapcontent').click(function() {\n              \n              var id = $(this).attr('data-id');\n             \n              formelo.navigation().openActivity(8, {id:id});\n          });\n\t\t});\n      \n    }\n  });\n  \n};\n\nfunction openUser(id){\nformelo.navigation.openActivity(8, {id:id});\n}\n\nvar items = [];\n\nformelo.event().onIntent(function(data){\n\titems = data.detail.users;\n});\n\nformelo.event().onCreate(function(){\n\tshowMap(items);\n});"
            }
        },
        {
            "layout": "<div class=\"container-xs-height full-vh\">\n            <div class=\"row-xs-height\">\n            <div class=\"col-xs-height col-middle\">\n            <div class=\"error-container text-center\">\n            <h1 class=\"error-number\" style=\"color: grey;\">\n            <img id=\"audiobtn\" src = \"https://cdn3.iconfinder.com/data/icons/flat-icons-web/40/Record-512.png\" width=\"100\"/>\n            </h1>\n            <h5 style=\"color:grey\">Tap to start recording.</h5>\n             <audio id=\"pipeaudio\" controls>\n  <source id=\"pipeaudiosrc\" src=\"\" type=\"audio/wav\">\nAudio Playback not enabled.\n</audio>\n            <div id=\"results\">\n            \t\n               \n            </div>\n            </div>\n            </div>\n            </div>\n            </div>\n            \n            ",
            "css": "",
            "name": "New Audio Note",
            "resources": "",
            "events": {
                "ready": "var recording  \t= null;\nvar personID   \t= null;\nvar dealID \t\t= null;\nvar activityID \t= null;\nvar noteID \t\t= null;\nvar org_id\t\t= null;\nvar notif = formelo.require('notif');\n\nformelo.event().onIntent(function(data){\n   personID = data.detail.person_id;\n   dealID = data.detail.deal_id;\n   activityID = data.detail.activityID;\n   orgID = data.detail.org_id;\n});\n\nformelo.event().onCreate(function(){\n   $('#audiobtn').click(function(){\n       startRecording();\n   });\t\n});\n\nfunction sendData(url, _data, _method, _headers){\n    var data    = _data      || {};\n    var method  = _method    || 'GET';\n    var txDeferred = $.Deferred();\n    var headers = _headers || {};\n    if (isonline()){\n        $.ajax({\n            url : url,\n            type : method,\n            data : data,\n            cache: false,\n            processData: false,\n            contentType: false,\n            success : function(data){\n                txDeferred.resolve(data);\n            },\n            error: function(xhr){\n                txDeferred.reject(xhr);\n            },\n            timeout: TIMEOUT\n        });\n    } else{\n        txDeferred.reject('No internet connection');\n    }\n    return txDeferred.promise();\n}\n\nfunction postData(){\n  if (recording  === null){\n  \treturn showMessage('No recordings found.');\n  }\n  \n  var endPoint = 'https://api.pipedrive.com/v1/files?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51';\n  \n  var form_data = new FormData();\n  var matches = recording.match(/^data\\:(.+);base64,(.+)$/);\n  var blob = b64toBlob(matches[2], matches[1]);\n\n  form_data.append('file', blob);\n  form_data.append('deal_id', dealID);\n  form_data.append('person_id', personID);\n  form_data.append('activity_id', activityID);\n  \n  showMessage('Please wait...', 'long');\n  notif.show();\n  $.when(sendData(endPoint, form_data, 'POST'))\n   .done(function(){\n    \tnotif.hide();\n    \tshowMessage('Your Audio Note has been added.');\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n    \tnotif.hide();\n    \tshowMessage('Error adding error note. Please try again later');\n  \t\talert(JSON.stringify(e));\n   });\n}\n\nfunction startRecording(){\n    $('#results').html('');\n    formelo.html().get.header.menu().html('').hide().unbind();\n\tnavigator.device.capture.captureAudio(successCB, errorCB);\n}\n\nfunction errorCB(error) {\n    alert('Error code: ' + error.code, null, 'Capture Error');\n};\n\nfunction successCB(mediaFiles) {\n\ttry{\n    \tvar i, path, len;\n                for (i = 0, len = mediaFiles.length; i < len; i += 1) {\n                    path = mediaFiles[i].fullPath;\n                    var audioFile = mediaFiles[i];\n                    alert(JSON.stringify(audioFile));\n                    var file = new window.File(audioFile.name, audioFile.localURL,\n                        audioFile.type, audioFile.lastModifiedDate, audioFile.size);\n                    getData(file, function(encoded){\n                        recording = encoded;\n                        var audioPlaceholder = \"pipeaudio\";\n                        var audioSource = \"pipeaudiosrc\";\n                        var audio = document.getElementById(audioPlaceholder);\n                        var source = document.getElementById(audioSource);\n                        source.src = encoded;\n                        audio.load();\n                        $('#results').html('<p style=\"color:grey;\">Tap on the play icon to play.'); formelo.html().get.header.menu().html('Done').show().click(function(){\n                  \t\t  postData();\n             \t\t\t});\n                    });\n                }\n    } catch(e) {\n         alert(JSON.strignify(e));\n    }\n}\n\n\nvar getBinary = function(audioFile, callback){\n            try {\n                var reader = new FileReader();\n                reader.onloadend = function() {\n                    callback(reader.result);\n                };\n                reader.onerror = function(e){\n                    alert('error');\n                    console.log(JSON.stringify(e));\n                };\n                reader.readAsBinaryString(audioFile);\n            } catch (e){\n                alert(JSON.stringify(e));\n            }\n};\n\nvar getData = function(audioFile, callback){\n            try {\n                var reader = new FileReader();\n                reader.readAsDataURL(audioFile);\n                reader.onload = function(event) {\n                    callback(event.target.result);\n                };\n                reader.onerror = function(e){\n                    alert('error');\n                    console.log(JSON.stringify(e));\n                };\n            } catch (e){\n                alert(JSON.stringify(e));\n            }\n};\n\nfunction b64toBlob(b64Data, contentType, sliceSize) {\n  contentType = contentType || '';\n  sliceSize = sliceSize || 512;\n\n  var byteCharacters = atob(b64Data);\n  var byteArrays = [];\n\n  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n    var slice = byteCharacters.slice(offset, offset + sliceSize);\n\n    var byteNumbers = new Array(slice.length);\n    for (var i = 0; i < slice.length; i++) {\n      byteNumbers[i] = slice.charCodeAt(i);\n    }\n\n    var byteArray = new Uint8Array(byteNumbers);\n\n    byteArrays.push(byteArray);\n  }\n\n  var blob = new Blob(byteArrays, {type: contentType});\n  return blob;\n}"
            }
        },
        {
            "layout": "<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Name</label>\n\t<input placeholder=\"Tap here to type\" id=\"contact-name\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Organisation</label>\n\t<input placeholder=\"Tap to choose organization\" readonly=\"readonly\" id=\"contact-organisation\" data-id=\"\" type=\"text\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Phone Number</label>\n\t<input placeholder=\"Tap here to type\" id=\"contact-phone\" type=\"number\" class=\"form-control\"/>\n</div>\n<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Email Address</label>\n\t<input placeholder=\"Tap here to type\" id=\"contact-email\" type=\"email\" class=\"form-control\"/>\n</div>\n\n",
            "css": "",
            "name": "New Person",
            "resources": "",
            "events": {
                "ready": "var notif = formelo.require('notif');\nvar modalController = formelo.require('modalController');\nvar id = null;\nvar addContact = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/persons?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar name = $('#contact-name').val();\n    var org = $('#contact-organisation').attr('data-id');\n    var mail = [$('#contact-email').val()];\n    var phone = [$('#contact-phone').val()];\n    var data = {\n      name : name,\n      owner_id : 1, \n      org_id : org, \n      email : mail, \n      phone : phone\n    };\n  \tnotif.show();\n   showMessage(\"Sending...\");\n   $.when(fetchData(endPoint, data, \"POST\"))\n   .done(function(data){\n     \tnotif.hide();\n        showMessage('Your contact has been created.');\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \tshowMessage(\"Contact could not be created. Please try again.\");\n    });\n};\nvar updateContact = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/persons/\"+id+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar name = $('#contact-name').val();\n    var org = $('#contact-organisation').attr('data-id');\n    var mail = [$('#contact-email').val()];\n    var phone = [$('#contact-phone').val()];\n    var data = {\n      name : name,\n      owner_id : 1, \n      org_id : org, \n      email : mail, \n      phone : phone\n    };\n    alert(JSON.stringify(data));\n  \tnotif.show();\n   showMessage(\"Updating...\");\n   $.when(fetchData(endPoint, data, \"PUT\"))\n   .done(function(data){\n     \tnotif.hide();\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \tshowMessage(\"Contact could not be created. Please try again.\");\n    });\n};\nvar getDetailsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/persons/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    $.when(fetchData(endPoint))\n    .done(function(data){\n    \tvar item = data.data;\n      \t$('#contact-name').val(item.name);\n      \tif (item.org_id && item.org_id.value){\n        \t$('#contact-organisation').val(item.org_name).attr('data-id', item.org_id.value);\n        } else {\n        \t$('#contact-organisation').val('').attr('data-id', '');\n        }\n        \n        var mail = $('#contact-email').val(item.email.length ? item.email[0].value : '');\n        var phone = $('#contact-phone').val(item.phone.length ? item.phone[0].value : '');\n    })\n    .fail(function(e){\n      \tshowMessage('Something went wrong');\n        alert(JSON.stringify(e));\n    });  \t\n};\n\nfunction link(){\n\t$('#contact-organisation').click(function(){\n        formelo.navigation().openActivity(18);\n    });\n}\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'organizations'){\n    \t$('#contact-organisation').val(data.detail.name).attr('data-id', data.detail.id);\n    } \n});\n\nformelo.event().onIntent(function(data){\n\tid = data.detail.id;\n    isNew = data.detail.isNew;\n});\n\nfunction reset(){\n\t$('#contact-name').val('');\n    $('#contact-organisation').val('').attr('data-id', '');\n    $('#contact-email').val('');\n    $('#contact-phone').val('');\n}\n\nformelo.event().onCreate(function(){\n    reset();\n    link();\n    var finalText = \"Done\";\n    if (!isNew){\n        getDetailsForUser(id);\n        finalText = \"Edit\";\n    }\n\tformelo.html().get.header.menu().html(finalText).show().click(function(){\n        if (isNew){\n          \taddContact();\n        } else{\n          \tupdateContact();\n        }\n    });\n});"
            }
        },
        {
            "layout": "<div id=\"deals-filter-placeholder\"></div>",
            "css": "",
            "name": "Filter Deals",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nfunction getFilters(type){\n\tvar url = \"https://api.pipedrive.com/v1/filters?type=deals&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#deals-filter-placeholder').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#deals-filter-placeholder').attach(function(item){\n    \t\tformelo.navigation().openActivity(0, {type:'filter', filter_id:item});\n    \t});\n    })\n    .fail(function(e){\n        alert(JSON.stringify(e));\n    \tshowMessage('Something terrible has happened.');\n        $('#deals-filter-placeholder').html(loadingHtml);\n    });\n}\n\n\nformelo.event().onCreate(function(){\n\tgetFilters();\n});"
            }
        },
        {
            "layout": "<div id=\"activity-filter-placeholder\"></div>",
            "css": "",
            "name": "Filter Activities",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nfunction getFilters(type){\n\tvar url = \"https://api.pipedrive.com/v1/filters?type=activity&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#activity-filter-placeholder').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#activity-filter-placeholder').attach(function(item){\n    \t\tformelo.navigation().openActivity(9, {type:'filter', filter_id:item});\n    \t});\n    })\n    .fail(function(e){\n        alert(JSON.stringify(e));\n    \tshowMessage('Something terrible has happened.');\n        $('#activity-filter-placeholder').html(loadingHtml);\n    });\n}\n\n\nformelo.event().onCreate(function(){\n\tgetFilters();\n});"
            }
        },
        {
            "layout": "<div id=\"contact-filter-placeholder\"></div>",
            "css": "",
            "name": "Filter Contacts",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nfunction getFilters(type){\n\tvar url = \"https://api.pipedrive.com/v1/filters?type=people&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#contact-filter-placeholder').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#contact-filter-placeholder').attach(function(item){\n    \t\tformelo.navigation().openActivity(7, {type:'filter', filter_id:item});\n    \t});\n    })\n    .fail(function(e){\n        alert(JSON.stringify(e));\n    \tshowMessage('Something terrible has happened.');\n        $('#contact-filter-placeholder').html(loadingHtml);\n    });\n}\n\n\nformelo.event().onCreate(function(){\n\tgetFilters();\n});"
            }
        },
        {
            "layout": "<div id=\"persons-list\"></div>",
            "css": "",
            "name": "Persons",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = formelo.require('loadingHtml');\nvar errorHtml = formelo.require('errorHtml');\n\nfunction openPersons(){\n\tvar url = \"https://api.pipedrive.com/v1/persons?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  var data = {\n  \t\tsort : 'name ASC'\n  };\n  $('#persons-list').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n    \tvar id = str_random(20);\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'unique' : item.name+'|'+item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n        formelo.ui().listAdapter(resArr, '#persons-list').attach(function(item){\n            var val = item.split('|');\n            formelo.navigation().result({type:'persons', id:val[1], name : val[0]});\n    \t});\n    })\n    .fail(function(e){\n    \t$('#persons-list').html(errorHtml);\n    });\n}\n\nformelo.event().onCreate(function(){\n\topenPersons();\n});"
            }
        },
        {
            "layout": "<div id=\"organizationlist\"></div>",
            "css": "",
            "name": "Organizations",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = formelo.require('loadingHtml');\nvar errorHtml = formelo.require('errorHtml');\nfunction openOrganizations(){\n\tvar url = \"https://api.pipedrive.com/v1/organizations?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#organizationlist').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'unique' : item.name+'|'+item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#organizationlist').attach(function(item){\n            var val = item.split('|');\n            formelo.navigation().result({type:'organizations', id:val[1], name : val[0]});\n    \t});\n    })\n    .fail(function(e){\n    \t$('#organizationlist').html(errorHtml);\n    });\n}\n\nformelo.event().onCreate(function(){\n\topenOrganizations();\n});"
            }
        },
        {
            "layout": "<div id=\"maindeallist\"></div>",
            "css": "",
            "name": "Deals",
            "resources": "",
            "events": {
                "ready": "var loadingHtml = formelo.require('loadingHtml');\nvar errorHtml = formelo.require('errorHtml');\n\nfunction openDeals(){\n\tvar url = \"https://api.pipedrive.com/v1/deals?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#maindeallist').html(loadingHtml);\n  $.when(fetchData(url))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n    \tvar id = str_random(20);\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.title,\n              \t 'description' : item.formatted_value + ' - '+ item.org_name + ' - ' + item.person_name,\n                'unique' : item.title+'|'+item.id,\n                'image' : 'img/bg/'+item.title.trim().charAt(0).toUpperCase()+'.gif'\n            });\n        });\n        formelo.ui().listAdapter(resArr, '#maindeallist').attach(function(item){\n            var val = item.split('|');\n            formelo.navigation().result({type:'deals', id:val[1], name : val[0]});\n    \t});\n    })\n    .fail(function(e){\n    \t$('#maindeallist').html(errorHtml);\n    });\n}\n\nformelo.event().onCreate(function(){\n\topenDeals();\n});"
            }
        },
        {
            "layout": "<div class=\"row\" style=\"padding: 1% 3%;\">\n\t<div class=\"input-group transparent\">\n                    <span id=\"organization-filter\" class=\"input-group-addon\"><i class=\"fa fa-filter\"></i></span>\n                    <input type=\"text\" class=\"form-control\" id=\"organization-search\" placeholder=\"Search for people\" style=\"font-size:small !important;\"/>\n                    <span id=\"organization-map\" class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\n                </div>\n</div>\n\n<div id=\"organizationlist\">\n</div>",
            "css": "",
            "name": "All Organizations",
            "resources": "",
            "events": {
                "ready": "var items = [];\nvar type = 'main';\nvar filter_id = null;\nvar notif = formelo.require('notif');\nvar loadingHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            '<div class=\"progress-circle-indeterminate\"></div>' +\n            '</h1>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n   {\n                'icon' : 'fa fa-dollar',\n                'text' : 'Deals',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'deals'\n            },\n  {\n                'icon' : 'fa fa-calendar-o',            \n                'text' : 'Activities',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'activity'\n            },\n  {\n                'icon' : 'fa fa-user',\n                'text' : 'Contacts',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'contacts'\n            },\n  {\n                'icon' : 'fa fa-building',\n                'text' : 'Organization',\n                'link' : null,\n                'active' :  true,\n                'unique' : 'organization'\n            }\n];\n\n\n\nvar getUsers = function(){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/organizations?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    var data = {\n    \tfilter_id : filter_id\n    };\n  \t$('#organizationlist').html(loadingHtml);\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n        result.forEach(function(item){\n            resArr.push({\n            \t'name' : item.name,\n                'description' : item.org_id ? item.org_id.name : '',\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif',  \n                'time' : item.owner_id.active_flag ? 'active' : 'inactive'\n            });\n        });\n      \tformelo.ui().listAdapter(resArr, '#organizationlist').attach(function(item){\n    \t\tformelo.navigation().openActivity(21, {id : item});\n    \t});\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#organizationlist').html(errorHtml);\n    });\n  \tfilter_id = null;\n};\nvar searchUsers = function(searchTerm){\n  \tvar endPoint = \"https://api.pipedrive.com/v1/persons/find?term=dan&start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    var data = {\n    \tterm : searchTerm\n    };\n  \t$('#organizationlist').html(loadingHtml);\n\t$.when(fetchData(endPoint, data))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        items = result;\n      \tif (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.name,\n                  'description' : item.org_id ? item.org_name : '',\n                  'unique' : item.id,\n                  'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#organizationlist').attach(function(item){\n                formelo.navigation().openActivity(21, {id : item});\n            });\n        } else {\n        \t$('#organizationlist').html('');\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#userlist').html(errorHtml);\n    });\n};\nvar handleItem = function(item){\n  formelo.navigation().openActivity(1);\n};\n\nvar handleMenu = function(item){\n  if (item === 'contacts') {\n  \t formelo.navigation().openActivity(7);\n  } else  if (item === 'activity'){\n  \t formelo.navigation().openActivity(9);\n  } else  if (item === 'deals'){\n  \t formelo.navigation().openActivity(0);\n  } else if (item === 'organization') {\n  \t formelo.navigation().openActivity(20);\n  }\n};\n\nformelo.event().onIntent(function(data){\n\tfilter_id = data.detail.filter_id;\n});\n\nformelo.event().onCreate(function(){\n    formelo.html().get.header.menu().html('Add').show().click(function(){\n    \tformelo.navigation().openActivity(22, {isNew: true});\n    });\n    $('#organization-filter').unbind().click(function(){\n       formelo.navigation().openActivity(16);                                   \n    });\n    $('#organization-map').unbind().click(function(){\n       formelo.navigation().openActivity(11, {users : items});                    \n    });\n    $('#organization-search').unbind().on('change', function(){\n      var val = $(this).val();\n      if (val && val.length >= 3){\n       \t searchUsers(val);\n      }\n    });\n\tformelo.ui().footer(footer, function(item){\n    \thandleMenu(item);\n    });\n    getUsers(); \n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetUsers(); \n    }\n});\n\nformelo.event().onClose(function(data){\n  formelo.navigation().stopPropagation();\n  navigator.notification.confirm(\n    \t'', \n      \tfunction(buttonIndex){\n        \tif (buttonIndex == 1){\n            \tformelo.close();               \n            }\n        },\n      \t'Exit?', \n      \t['Yes', 'Cancel'],\n      \t''\n    );\n});"
            }
        },
        {
            "layout": "<div>\n\t<div class=\"card share full-height no-margin-card\" data-social=\"item\">\n\t<div class=\"card-header clearfix Sv8OzZm2qNpieKvIYvZq\" unique=\"asshole\">\n\t\t<div class=\"user-pic pull-left\"><img id=\"organization-image\" alt=\"Profile Image\" width=\"33\" height=\"33\" src=\"img/loading.png\"></div>\n\t\t<h6 id=\"organization-time\" style=\"float: right; font-size: xx-small; display: inline;\"></h6>\n\t\t<div style=\"margin-left: 40px\">\n\t\t\t<h5 id=\"organization-name\" style=\"font-weight: 300;\">Loading</h5>\n\t\t\t<h6 id=\"organization-description\"></h6>\n\t\t</div>\n\t</div>\n</div>\n</div>\n\n<div>\n\t<ul class=\"nav nav-tabs nav-tabs-simple nav-tabs-up bg-white\" id=\"tab-3\">\n    \t<li style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#organization-persons\" aria-expanded=\"true\">Persons</a>\n\t\t</li>\n\t\t<li class=\"active\" style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#organization-flows\" aria-expanded=\"true\">Activities</a>\n\t\t</li>\n        <li style=\"width:25%\">\n\t\t\t<a style=\"text-align: center;\" data-toggle=\"tab\" href=\"#organization-deals\" aria-expanded=\"true\">Deals</a>\n\t\t</li>\n        \n\t</ul>\n\t<div class=\"tab-content bg-white\" style=\"\n\t\theight: 70vh;max-height:height: 70vh; overflow:scroll\">\n\t\t<div class=\"tab-pane active\" id=\"organization-flows\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n        <div class=\"tab-pane active\" id=\"organization-deals\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n        <div class=\"tab-pane active\" id=\"organization-persons\">\n\t\t\t<div class=\"row column-seperation\">\n\t\t\t\t<div style=\"width: 100%;\n\t\t\t\t\t\">\n\t\t\t\t\t<h3 style=\"line-height: 60vh;\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: center;\">\n\t\t\t\t\t\t<span class=\"semi-bold\" style=\"color:grey;\">Loading</span><br>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>",
            "css": "",
            "name": "Organization Details",
            "resources": "",
            "events": {
                "ready": "var personID = null;\nvar orgID  = null;\nvar modalController = formelo.require('modalController');\nvar activityMap = formelo.require('activityMap');\nvar notif = formelo.require('notif');\nvar sendFile = formelo.require('sendFile');\nvar loadingHtml = formelo.require('loadingHtml');\n\nvar errorHtml = '<div class=\"container-xs-height full-vh\">' +\n            '<div class=\"row-xs-height\">' +\n            '<div class=\"col-xs-height col-middle\">' +\n            '<div class=\"error-container text-center\">' +\n            '<h1 class=\"error-number\" style=\"color: grey;\">' +\n            ':(' +\n            '</h1>' +\n            '<h2 class=\"semi-bold\" style=\"color: grey\">Well, this is embarrasing.</h2>' +\n            '<p class=\"fs-12 hint-text\" style=\"text-align: center; padding: 0px  10px; text-shadow: none;\">An Error has occured. Please try again</p>' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\nvar footer = [\n   {\n                'icon' : 'fa fa-plus',\n                'text' : 'Add',\n                'link' : null,\n                'active' :  false,\n                'unique' : 'add'\n            }\n];\n\n\n\nvar add = function(buttonIndex){\n  \t\t   if (buttonIndex == 'note'){\n              if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(2, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            \tformelo.navigation().openActivity(2);\n            } else if (buttonIndex == 'activity'){\n                if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(3, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            \t\n            } else if (buttonIndex == 'deal') {\n              if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(5, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            } else if (buttonIndex == 'audio') {\n                if (orgID !== null && personID !== null){\n                  formelo.navigation().openActivity(12, {person_id : personID, org_id : orgID});\n                } else {\n                \tshowMessage(\"Please wait for contact details to load.\");\n                }\n            } else if (buttonIndex == 'photo'){\n            \tformelo.hooks.getImage(function(data){\n                  \tsendFile(data, personID, null, null, function(){\n                    \tgetFilesForUser(id);\n                    });\n                }, function(err){\n                \tshowMessage(JSON.stringify(err));\n                });\n            }\n};\n\n\nfunction showOptions(){\n  \t\tvar options = [\n  {\n  \tunique : 'activity',\n    name : 'Activity',\n    image : 'http://img3.cliparto.com/pic/s/196419/4423411-men-sign.jpg'\n  }, \n          {\n  \tunique : 'deal',\n    name : 'Deal',\n    image : 'http://img5.cliparto.com/pic/s/256180/5517229-money-icon-flat-design-style.jpg'\n  }, \n  {\n  \tunique : 'note',\n    name : 'Note',\n    image : 'http://a2.mzstatic.com/us/r30/Purple60/v4/62/2e/eb/622eeb3f-2caf-83f8-e49a-a4fb366659b4/icon100x100.png'\n  }, \n  {\n  \tunique : 'photo',\n    name : 'Photo',\n    image : 'http://www.bodycharity.co.uk/images/flatin.png'\n  }, \n  {\n  \tunique : 'audio',\n    name : 'Audio Note',\n    image : 'http://img5.cliparto.com/pic/s/256180/5107668-microphone-web-icon-flat-design.jpg'\n  }, \n  {\n  \tunique : 'cancel',\n    name : 'Cancel',\n    image : 'https://i.downloadatoz.com/download/icon2/6/a/5/b5b33b4c9ebcdf57be7c09dceb4465a6.jpg'\n  }];\n    \n\n  \t\tvar id = str_random(20);\n\t\tvar mod = formelo.ui().modal('Options','<div id=\"'+id+'\"></div>');\n      \tformelo.ui().listAdapter(options, '#'+id).attach(function(item){\n    \t\tmod.close();\n          \tadd(item);\n    \t});\n\n}\n\nvar id = null;\n\nvar getUsersForOrganization =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+dealID+\"/persons?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#organization-persons').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n            \t'name' : item.name,\n                //'description' : item.org_id ? item.org_id.name : '',\n                'unique' : item.id,\n                'image' : 'img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif'  \n                //'time' : item.owner_id.active_flag ? 'active' : 'inactive'\n            \t});\n        \t});\n            formelo.ui().listAdapter(resArr, '#organization-persons').attach(function(item){\n                formelo.navigation().openActivity(8, {id : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Flows</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#organization-persons').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#organization-persons').html(errorHtml);\n    });\n};\n\nvar getActivityForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+dealID+\"/activities?start=0&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#organization-flows').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.subject,\n                  'description' : item.due_date + ' '+ item.due_time + ' - ' + item.owner_name,\n                  'unique' : item.id,\n                  'image' : activityMap[item.type]['icon']\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#organization-flows').attach(function(item){\n                formelo.navigation().openActivity(3, {isNew: false, activityID : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Flows</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#organization-flows').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#organization-flows').html(errorHtml);\n    });\n};\nvar getDealsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+dealID+\"/deals?start=0&status=all_not_deleted&api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  $('#organization-deals').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar result = data.data;\n        var resArr = [];\n        if (result && result.length){\n        \tresult.forEach(function(item){\n              resArr.push({\n                  'name' : item.title,\n                  'description' : item.formatted_value,\n                  'unique' : item.id,\n                  'image' : 'img/bg/'+item.title.trim().charAt(0).toUpperCase()+'.gif'\n              });\n        \t});\n            formelo.ui().listAdapter(resArr, '#organization-deals').attach(function(item){\n                formelo.navigation().openActivity(6, {id : item});\n            });\n        } else {\n        \tvar html = '<div class=\"row column-seperation\">'+\n\t\t\t\t'<div style=\"width: 100%;'+\n\t\t\t\t\t'\">'+\n\t\t\t\t\t'<h3 style=\"line-height: 60vh;'+\n\t\t\t\t\t\t'vertical-align: middle;'+\n\t\t\t\t\t\t'text-align: center;\">'+\n\t\t\t\t\t\t'<span class=\"semi-bold\" style=\"color:grey;\">No Deals</span><br>'+\n\t\t\t\t\t'</h3>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>';\n          \t$('#organization-deals').html(html);\n        }\n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#organization-deals').html(errorHtml);\n    });\n};\n\nvar getDetailsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    $('#organization-details').html(loadingHtml);\n\t$.when(fetchData(endPoint))\n    .done(function(data){\n      \tvar item = data.data;\n        var resArr = [];\n        personID = item.id;\n        orgID = item.org_id ? item.org_id.value : null;\n        $('#organization-name').html(item.name);\n        $('#user-image').attr('src','img/bg/'+item.name.trim().charAt(0).toUpperCase()+'.gif');\n           \n    })\n    .fail(function(e){\n    \tshowMessage('Something terrible has happened.' + JSON.stringify(e));\n        $('#organization-details').html(errorHtml);\n    });\n};\n\n\nvar sidemenu = [\n  {\n  \tunique : 'edit',\n    text : 'Edit',\n    icon : 'fa fa-edit'\n  },\n  {\n  \tunique : 'activity',\n    text : 'Activity',\n    icon : 'fa fa-calendar'\n  }, \n  {\n  \tunique : 'note',\n    text : 'Note',\n    icon : 'pg-note'\n  }, \n  {\n  \tunique : 'photo',\n    text : 'Photo',\n    icon : 'fa fa-photo'\n  }, \n  {\n  \tunique : 'audio',\n    text : 'Audio Note',\n    icon : 'fa fa-microphone'\n  }, {\n  \tunique : 'cancel',\n    text : 'Cancel',\n    icon : 'pg-more'\n  }\n];\n\n\nformelo.event().onIntent(function(data){\n  id = data.detail.id;\n});\n\nformelo.event().onResult(function(data){\n\tif (data.detail.type === 'reload'){\n    \tgetActivityForUser(id);\n        getDetailsForUser(id);\n        getDealsForUser(id);\n        //getFilesForUser(id);\n      \tgetUsersForOrganization(id);\n      \n    }\n});\n\nformelo.event().onCreate(function(){\n  formelo.html().get.header.menu().html('Edit').show().click(function(){\n    \tformelo.navigation().openActivity(22, {isNew: false, id : id});\n  });\n  formelo.ui().footer(footer, function(item){\n     showOptions();\n  });\n  getActivityForUser(id);\n  getDetailsForUser(id);\n  getDealsForUser(id);\n  getUsersForOrganization(id);\n});"
            }
        },
        {
            "layout": "<div class=\"form-group form-group-default\">\n\t<label for=\"aa\" class=\"formelo-form-label\">Name</label>\n\t<input placeholder=\"Tap here to type\" id=\"organization-name\" type=\"text\" class=\"form-control\"/>\n</div>\n\n\n\n",
            "css": "",
            "name": "Add Organization",
            "resources": "",
            "events": {
                "ready": "var notif = formelo.require('notif');\nvar modalController = formelo.require('modalController');\nvar id = null;\nvar addContact = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/organizations?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar name = $('#organization-name').val();\n    \n    var data = {\n      name : name\n    };\n  \tnotif.show();\n   showMessage(\"Sending...\");\n   $.when(fetchData(endPoint, data, \"POST\"))\n   .done(function(data){\n     \tnotif.hide();\n        showMessage('Your contact has been created.');\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \tshowMessage(\"Contact could not be created. Please try again.\");\n    });\n};\nvar updateContact = function(){\n     var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+id+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n  \tvar name = $('#organization-name').val();\n    \n    var data = {\n      name : name\n    };\n    alert(JSON.stringify(data));\n  \tnotif.show();\n   showMessage(\"Updating...\");\n   $.when(fetchData(endPoint, data, \"PUT\"))\n   .done(function(data){\n     \tnotif.hide();\n        formelo.navigation().result({type:'reload'});\n   })\n   .fail(function(e){\n     \tnotif.hide();\n     \tshowMessage(\"Contact could not be created. Please try again.\");\n    });\n};\nvar getDetailsForUser =  function (dealID){\n  var endPoint = \"https://api.pipedrive.com/v1/organizations/\"+dealID+\"?api_token=8921fdbe67678f310359ec1ce5b51137e39d2f51\";\n    $.when(fetchData(endPoint))\n    .done(function(data){\n    \tvar item = data.data;\n      \t$('#organization-name').val(item.name);\n    })\n    .fail(function(e){\n      \tshowMessage('Something went wrong');\n        alert(JSON.stringify(e));\n    });  \t\n};\n\nfunction link(){\n\t\n}\n\nformelo.event().onResult(function(data){\n\t\n});\n\nformelo.event().onIntent(function(data){\n\tid = data.detail.id;\n    isNew = data.detail.isNew;\n});\n\nfunction reset(){\n\t$('#organization-name').val('');\n}\n\nformelo.event().onCreate(function(){\n    reset();\n    link();\n    var finalText = \"Save\";\n    if (!isNew){\n        getDetailsForUser(id);\n        finalText = \"Edit\";\n    }\n\tformelo.html().get.header.menu().html(finalText).show().click(function(){\n        if (isNew){\n          \taddContact();\n        } else{\n          \tupdateContact();\n        }\n    });\n});"
            }
        }
    ],
    "scope": "private",
    "name": "Mobile Salesforce",
    "reference_code": "35abc207-685b-11e6-8eca-93311c055cc1",
    "realm": {
        "id": "d9f3a9a9"
    },
    "id": "dac0d9e3",
    "created_date": "2016-08-22T11:27:27",
    "user": {
        "code": "rd@pmglobaltechnology.com",
        "id": "d9e3a9a9"
    },
    "status": "live"
}